<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://github.githubassets.com/favicons/favicon.svg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="## **基本使用**
#### **1.企业的流行框架**
SSM：Spring、SpringMVC、MyBatis
Apache Shiro
SpingBoot

#### **2.客户端请求流程**
- 客户端请求会先来到 `控制层Servlet/Controller`，再到 `业务层Service`，最后为 `数据持久层Dao`。">
<meta property="og:title" content="MyBatis基础">
<meta property="og:description" content="## **基本使用**
#### **1.企业的流行框架**
SSM：Spring、SpringMVC、MyBatis
Apache Shiro
SpingBoot

#### **2.客户端请求流程**
- 客户端请求会先来到 `控制层Servlet/Controller`，再到 `业务层Service`，最后为 `数据持久层Dao`。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://shuaiwang888.github.io/appStore-Blog.github.io/post/MyBatis-ji-chu.html">
<meta property="og:image" content="https://github.githubassets.com/favicons/favicon.svg">
<title>MyBatis基础</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">MyBatis基础</h1>
<div class="title-right">
    <a href="https://shuaiwang888.github.io/appStore-Blog.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/shuaiwang888/appStore-Blog.github.io/issues/12" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h2><strong>基本使用</strong></h2>
<h4><strong>1.企业的流行框架</strong></h4>
<p>SSM：Spring、SpringMVC、MyBatis<br>
Apache Shiro<br>
SpingBoot</p>
<h4><strong>2.客户端请求流程</strong></h4>
<ul>
<li>客户端请求会先来到 <code class="notranslate">控制层Servlet/Controller</code>，再到 <code class="notranslate">业务层Service</code>，最后为 <code class="notranslate">数据持久层Dao</code>。</li>
<li>数据层框架：纯JDBC -&gt; SpringJDBC + Druid -&gt; MyBatis  所以MyBatis是面向数据层的框架，封装了JDBC的很多操作细节，让开发者大大简化了Dao层的代码；</li>
</ul>
<h4><strong>3.数据库事务</strong></h4>
<ul>
<li><strong>简单概念：</strong> 如果将N个数据库操作(sql语句)放到了同一个事务中，那么这N个操作(sql语句)最终要么全都生效，要么全都不生效。</li>
<li><strong>事务的使用：</strong> <code class="notranslate">START TRANSACTION</code>;</li>
<li><strong>回滚事务：</strong> <code class="notranslate">ROLLBACK</code>  只要事务中的一个操作失败，那么其他所有操作都需要回滚（rollback），回到开启事务之前的状态，之前操作无效；</li>
<li><strong>提交事务：</strong> <code class="notranslate">COMMIT</code> 如果事务中的所有操作都成功了，就提交事务，让这些操作真正生效；</li>
<li>回滚事务于提交事务都是结束事务的一种方式；</li>
<li>JDBC的事务管理：在JDBC中使用 <code class="notranslate">Connection</code> 对象来管理事务，其中<code class="notranslate">setAutoCommit(false/true)</code> 来开启事务，<code class="notranslate">prepareStatement(sql)和executeUpdate()</code>执行sql语句，<code class="notranslate">commit()</code> 来提交事务，<code class="notranslate">rollback()</code> 来回滚事务；</li>
</ul>
<h4><strong>4.事务的四大特性</strong></h4>
<blockquote>
<p><strong>原子性（Atomicity）：</strong> 事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行。<br>
<strong>一致性（Consistency）：</strong> 事务应确保数据库的状态从一个一致状态转变为另一个一致状态。一致状态的含义是数据库中的数据应满足完整性约束。<br>
<strong>隔离性（Isolation）：</strong> 多个事务并发执行时，一个事务的执行不应影响其他事务的执行。<br>
<strong>持久性（Durability）：</strong> 已被提交的事务对数据库的修改应该永久保存在数据库中</p>
</blockquote>
<h4><strong>5.如何使用MyBatis？</strong></h4>
<ul>
<li>
<ol>
<li><strong>依赖：</strong> mybatis、mysql-connector-java(MySQL数据库驱动包)</li>
</ol>
</li>
<li>
<ol start="2">
<li><strong>创建核心配置文件mybatis-config.xml:</strong> 核心配置的主要标签就是<code class="notranslate">&lt;environments/&gt;</code>、<code class="notranslate">&lt;plugins/&gt;</code>、<code class="notranslate">&lt;typeAliases/&gt;</code>、<code class="notranslate">&lt;settings/&gt;</code>、<code class="notranslate">&lt;properties/&gt;</code></li>
</ol>
</li>
<li>
<ol start="3">
<li><strong>在 <code class="notranslate">&lt;environments/&gt;</code> 中</strong>，我们可以添加属性environment来标记多场景下使用哪个环境id（在此标签中可以配置多个环境），<strong>transactionManager</strong> 属性作用是标明采用JDBC事务管理方法来管理事务，而主要 <strong>dataSource</strong> 可以标明哪种方式管理连接，一般采用连接池（而连接池可以是POOLED类型或者DRUID类型），而以下就是配置连接 <code class="notranslate">&lt;property name="xxx" value="xxx"/&gt;</code>这里的name一般为 <code class="notranslate">driver</code>、<code class="notranslate">url</code>、<code class="notranslate">username</code>、<code class="notranslate">password</code>等基础配置，还有druid连接池的initialSize、maxActive、maxWait等。</li>
</ol>
</li>
<li>
<ol start="4">
<li>而在 <strong><code class="notranslate">&lt;plugins/&gt;</code></strong> 标签中可以配置MyBatis分页插件，可以就简化了查询分页的复杂操作。</li>
</ol>
</li>
<li>
<ol start="5">
<li><strong><code class="notranslate">&lt;typeAliases/&gt;</code></strong> 标签可以配置别名，如 <code class="notranslate">&lt;typeAlias type="com.ws.bean.Skill" alias="skill" /&gt;</code></li>
</ol>
</li>
<li>
<ol start="6">
<li><strong></strong> 标签一般为其他设置，如数据库名到Java中Bean对象的转换：<strong>数据库：my_first_name -&gt; Java：myFirstName</strong> （开启驼峰命名自动映射）</li>
</ol>
</li>
<li>
<ol start="7">
<li>若想通过JDBC来管理事务并访问该表，需要添加一个映射xml文件，该文件就是为了实现Skill JavaBean与数据库skill表之间的映射。</li>
</ol>
</li>
<li>
<ol start="8">
<li>xxx.xml映射文件的根标签为 <code class="notranslate">&lt;mapper/&gt;</code> 在这里就可以编写sql语句，而且可以编写动态sql语句，新建的映射文件可以放在resources下的mapper文件里。如 resources/mapper/skill.xml<br>
<a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918102846-b06180a499ad488abb912fb8e6ea0279.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918102846-b06180a499ad488abb912fb8e6ea0279.png" alt="QQ图片20210918102846.png" style="max-width: 100%;"></a></li>
</ol>
</li>
<li>
<ol start="9">
<li>当然了，也要mybatis配置文件中的 <code class="notranslate">&lt;mapper/&gt;</code> 添加实体映射文件路径。</li>
</ol>
</li>
<li>
<ol start="10">
<li>如何使用java代码加载使用？ 用工厂构建器构建工厂后创建Session并执行对应的sql语句</li>
</ol>
</li>
</ul>
<p><strong>总结：</strong> 拿到数据库的数据的流程？</p>
<blockquote>
<p>先在pom.xml中配置mybatis、mysql、junit等的依赖;</p>
</blockquote>
<blockquote>
<p>在mybatis-config.xml文件中配置环境：JDBC事务、POOLED连接池等;</p>
</blockquote>
<blockquote>
<p>创建Bean对象并配置Bean与对应数据库表之间的映射文件;</p>
</blockquote>
<blockquote>
<p>再在mybatis配置文件中添加映射文件路径供统一加载;</p>
</blockquote>
<blockquote>
<p>写测试代码，用工厂构建器构建工厂后创建Session并执行对应的sql语句;</p>
</blockquote>
<h4><strong>6.传参</strong></h4>
<ul>
<li>
<p>在mapper映射文件中添加select标签，其中用 <code class="notranslate">#{xxx}</code> 是参数在mapper.xml文件中sql语句的占位符。</p>
</li>
<li>
<p>注意：${}是直接文本替换，而#{}为预编译传值，可以防止SQL注入，所以我们一般使用#{};<br>
<a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918105358-5f33313977214c9fade409bdd52f575a.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918105358-5f33313977214c9fade409bdd52f575a.png" alt="QQ图片20210918105358.png" style="max-width: 100%;"></a></p>
</li>
<li>
<p>同理传入多个参数也是一样<br>
<a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918105512-65527d0160d14f46bf2ffef1485720cc.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918105512-65527d0160d14f46bf2ffef1485720cc.png" alt="QQ图片20210918105512.png" style="max-width: 100%;"></a></p>
</li>
<li>
<p>以上可知：只需创建一次工厂即可，后续直接MyBatises.openSession()获取连接session，其中参数设置为true时表示自动提交事务，否则需要手动提交，而查询操作不需要提交事务，只有对数据库进行操作的才要提交事务。</p>
</li>
<li>
<p>所以在当用'$'符号时，不能是由用户传进来的，但也不能全用#符号进行传参，'$'存在即合理，在直接替换的地方可以使用$，而#是要进行预编译的。</p>
</li>
</ul>
<blockquote>
<p>在输出打印sql语句时，可以直接在mybatis配置文件中配置，也可以使用第三方库，如logback等，这样便可以看见更为详细的日志输出。</p>
</blockquote>
<h4><strong>7.多表查询（关联表）</strong></h4>
<ul>
<li>将resultType设置为Map、HashMap、LinkedHashMap等，其中LinkedHashMap可以实现添加顺序打印<br>
<a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918144844-85e57c3bcb304f0c99d3972a2fa3bf22.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918144844-85e57c3bcb304f0c99d3972a2fa3bf22.png" alt="QQ图片20210918144844.png" style="max-width: 100%;"></a></li>
</ul>
<blockquote>
<p>映射文件中的输入类型parameterType与输出resultType在后续的定义各种Object对象会有所区分，在这里都会一样的po对象</p>
</blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918145129-df1a528d54904291bd98bb19be430432.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918145129-df1a528d54904291bd98bb19be430432.png" alt="QQ图片20210918145129.png" style="max-width: 100%;"></a></p>
<ul>
<li>这样便可以实现多表查询</li>
</ul>
<h2><strong>MyBatis的增删改</strong></h2>
<h4><strong>1.添加（增）</strong></h4>
<ul>
<li>在xml中，添加的标签是 <code class="notranslate">&lt;insert/&gt;</code> 添加的输入参数类型是Bean对象：</li>
</ul>
<div class="highlight highlight-source-sql"><pre class="notranslate">    <span class="pl-k">&lt;</span>!<span class="pl-c"><span class="pl-c">--</span>添加（增）--&gt;</span>
    <span class="pl-k">&lt;</span>insert id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>insert<span class="pl-pds">"</span></span> parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Skill<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">INSERT INTO</span> skill(name, level) <span class="pl-k">VALUES</span>(<span class="pl-c"><span class="pl-c">#</span>{name}, #{level})</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>insert<span class="pl-k">&gt;</span></pre></div>
<blockquote>
<p>注意 <code class="notranslate">resultType（输出）</code> 与 <code class="notranslate">parameterType（输入）</code> 的区别</p>
</blockquote>
<ul>
<li>在测试代码中，需要先获取连接session，再新建Bean对象传入参数，最后调用insert()函数执行添加sql语句</li>
</ul>
<div class="highlight highlight-source-java"><pre class="notranslate">    <span class="pl-c">// 增</span>
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">insert</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> = <span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"iOS"</span>, <span class="pl-c1">8</span>);
            <span class="pl-s1">session</span>.<span class="pl-en">insert</span>(<span class="pl-s">"skill.insert"</span>, <span class="pl-s1">skill</span>);
        }
    }</pre></div>
<blockquote>
<p>这里的 <code class="notranslate">MyBatises.openSession(true)</code> 中设置为true，表示执行完后自动提交事务，为下面的inser函数参数处理Bean对象外，还有就是标明执行的是xml文件的id为insert的sql语句。</p>
</blockquote>
<h4><strong>若想在插入数据后，如何直接返回对应的插入id值？</strong> --需要主键设置</h4>
<ul>
<li>这是是不能再写一条sql语句去查询刚刚插入到数据库的数据id值，因为这样存在多线程问题！</li>
<li>第一种方法就是设置新插入记录的主键id到参数对象中:</li>
</ul>
<p>xml的sql代码</p>
<div class="highlight highlight-source-sql"><pre class="notranslate">    <span class="pl-k">&lt;</span>insert id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>insert2<span class="pl-pds">"</span></span> parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Skill<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">INSERT INTO</span> skill(name, level) <span class="pl-k">VALUES</span>(<span class="pl-c"><span class="pl-c">#</span>{name}, #{level})</span>
        <span class="pl-k">&lt;</span>selectKey resultType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> keyProperty<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> order<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>AFTER<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
            <span class="pl-k">SELECT</span> LAST_INSERT_ID()
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>selectKey<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>insert<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>!<span class="pl-c"><span class="pl-c">--</span>使用selectKey标签：resulType返回值id为int类型，keyProperty为属性名id，order=AFTER 设置返回id的操作是在上面sql语句执行之后，SELECT LAST_INSERT_ID() 是查询最后一次插入的id值--&gt;</span></pre></div>
<p>java代码：</p>
<div class="highlight highlight-source-java"><pre class="notranslate">    <span class="pl-c">// 设置新插入记录的主键id到参数对象中</span>
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">insert2</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> = <span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"Android"</span>, <span class="pl-c1">9</span>);
            <span class="pl-s1">session</span>.<span class="pl-en">insert</span>(<span class="pl-s">"skill.insert2"</span>, <span class="pl-s1">skill</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">skill</span>.<span class="pl-en">getId</span>()); <span class="pl-c">// 插入后拿到对应id</span>
            <span class="pl-s1">session</span>.<span class="pl-en">commit</span>(); <span class="pl-c">// 手动提交事务管理</span>
        }
    }</pre></div>
<ul>
<li>第二种方法就是使用useGeneratedKeys，keyProperty属性，但方法需要数据库驱动支持，如适用于MySQL,不适用Oracle，java代码相似。</li>
</ul>
<div class="highlight highlight-source-sql"><pre class="notranslate">    <span class="pl-k">&lt;</span>insert id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>insert3<span class="pl-pds">"</span></span>
            useGeneratedKeys<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>
            keyProperty<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
            parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Skill<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">INSERT INTO</span> skill(name, level) <span class="pl-k">VALUES</span>(<span class="pl-c"><span class="pl-c">#</span>{name}, #{level})</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>insert<span class="pl-k">&gt;</span></pre></div>
<h4><strong>2.更新与删除</strong></h4>
<p>xml</p>
<div class="highlight highlight-source-sql"><pre class="notranslate">    <span class="pl-k">&lt;</span>!<span class="pl-c"><span class="pl-c">--</span> 更新：在传入id参数后，更新值 --&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">update</span> id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>update<span class="pl-pds">"</span></span> parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Skill<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">UPDATE</span> skill <span class="pl-k">SET</span> name <span class="pl-k">=</span> <span class="pl-c"><span class="pl-c">#</span>{name}, level = #{level} WHERE id = #{id}</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span><span class="pl-k">update</span><span class="pl-k">&gt;</span>

    <span class="pl-k">&lt;</span>!<span class="pl-c"><span class="pl-c">--</span> 删除：只需要id --&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">delete</span> id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>delete<span class="pl-pds">"</span></span> parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">DELETE</span> <span class="pl-k">FROM</span> skill <span class="pl-k">WHERE</span> id <span class="pl-k">=</span> <span class="pl-c"><span class="pl-c">#</span>{id}</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span><span class="pl-k">delete</span><span class="pl-k">&gt;</span></pre></div>
<p>java</p>
<div class="highlight highlight-source-java"><pre class="notranslate">    <span class="pl-c">// 更新</span>
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">update</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-c">// 将id值为2的数据改为Java(name)和666(level)</span>
            <span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> = <span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"Java"</span>, <span class="pl-c1">666</span>);
            <span class="pl-s1">skill</span>.<span class="pl-en">setId</span>(<span class="pl-c1">2</span>);

            <span class="pl-s1">session</span>.<span class="pl-en">update</span>(<span class="pl-s">"skill.update"</span>, <span class="pl-s1">skill</span>);
            <span class="pl-s1">session</span>.<span class="pl-en">commit</span>();
        }
    }

    <span class="pl-c">// 删除</span>
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">delete</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {

            <span class="pl-s1">session</span>.<span class="pl-en">delete</span>(<span class="pl-s">"skill.delete"</span>, <span class="pl-c1">1</span>);

            <span class="pl-s1">session</span>.<span class="pl-en">commit</span>();
        }
    }</pre></div>
<h4><strong>3.动态sql</strong></h4>
<blockquote>
<p><strong>if标签</strong><br>
xml</p>
</blockquote>
<div class="highlight highlight-source-sql"><pre class="notranslate">    <span class="pl-k">&lt;</span>!<span class="pl-c"><span class="pl-c">--</span>动态生成SQL语句--&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">select</span> id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>dynamicSQL1<span class="pl-pds">"</span></span> parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Map<span class="pl-pds">"</span></span> resultType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Skill<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> skill <span class="pl-k">WHERE</span> <span class="pl-c1">1</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>

        <span class="pl-k">&lt;</span>if test<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>id != null<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
            <span class="pl-k">AND</span> id <span class="pl-k">&gt;</span> <span class="pl-c"><span class="pl-c">#</span>{id}</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>if<span class="pl-k">&gt;</span>

        <span class="pl-k">&lt;</span>if test<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>name != null<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
            <span class="pl-k">AND</span> name <span class="pl-k">LIKE</span> <span class="pl-c"><span class="pl-c">#</span>{name}</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>if<span class="pl-k">&gt;</span>

        <span class="pl-k">&lt;</span>if test<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>level != null<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
            <span class="pl-k">AND</span> level &amp;lt; <span class="pl-c"><span class="pl-c">#</span>{level}</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>if<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span><span class="pl-k">select</span><span class="pl-k">&gt;</span></pre></div>
<ul>
<li>由上可以看出：动态生成sql十分方便，而在javaEE中使用springJDBC是十分的麻烦！ <code class="notranslate">SELECT * FROM skill WHERE 1 = 1</code> 后便是根据传入的参数，动态生成sql语句的逻辑；<code class="notranslate">if test</code> 测试条件成功之后拼接条件sql语句！</li>
</ul>
<p>java</p>
<div class="highlight highlight-source-java"><pre class="notranslate">    <span class="pl-c">// 动态sql</span>
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">dynamicSQL</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-smi">Map</span>&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Object</span>&gt; <span class="pl-s1">param</span> = <span class="pl-k">new</span> <span class="pl-smi">HashMap</span>&lt;&gt;();
            <span class="pl-s1">param</span>.<span class="pl-en">put</span>(<span class="pl-s">"id"</span>, <span class="pl-c1">2</span>);
            <span class="pl-s1">param</span>.<span class="pl-en">put</span>(<span class="pl-s">"name"</span>, <span class="pl-s">"%s%"</span>);
            <span class="pl-s1">param</span>.<span class="pl-en">put</span>(<span class="pl-s">"level"</span>, <span class="pl-c1">600</span>);

            <span class="pl-c">/*</span>
<span class="pl-c">            sql的存在形式:</span>
<span class="pl-c">            SELECT * FROM skill WHERE 1 = 1</span>
<span class="pl-c">            AND id &gt; #{id}</span>
<span class="pl-c">            AND name LIKE #{name}</span>
<span class="pl-c">            AND level &lt; #{level}</span>
<span class="pl-c">  </span>
<span class="pl-c">            意思就是：查询id大于2且name中包含 s 且 level小于600的满足条件的数据</span>
<span class="pl-c">             */</span>

            <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-s1">skills</span> = <span class="pl-s1">session</span>.<span class="pl-en">selectList</span>(<span class="pl-s">"skill.dynamicSQL1"</span>, <span class="pl-s1">param</span>);

            <span class="pl-k">for</span> (<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> : <span class="pl-s1">skills</span>) {
                <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">skill</span>);
            }
        }
    }</pre></div>
<blockquote>
<p><strong>where标签</strong></p>
</blockquote>
<p>xml</p>
<div class="highlight highlight-source-sql"><pre class="notranslate">    <span class="pl-k">&lt;</span><span class="pl-k">select</span> id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>dynamicSQL2<span class="pl-pds">"</span></span> parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Map<span class="pl-pds">"</span></span> resultType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Skill<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> skill

        <span class="pl-k">&lt;</span><span class="pl-k">where</span><span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>if test<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>id != null<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
                <span class="pl-k">AND</span> id <span class="pl-k">&gt;</span> <span class="pl-c"><span class="pl-c">#</span>{id}</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>if<span class="pl-k">&gt;</span>

            <span class="pl-k">&lt;</span>if test<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>name != null<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
                <span class="pl-k">AND</span> name <span class="pl-k">LIKE</span> <span class="pl-c"><span class="pl-c">#</span>{name}</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>if<span class="pl-k">&gt;</span>

            <span class="pl-k">&lt;</span>if test<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>level != null<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
                <span class="pl-k">AND</span> level &amp;lt; <span class="pl-c"><span class="pl-c">#</span>{level}</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>if<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span><span class="pl-k">where</span><span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span><span class="pl-k">select</span><span class="pl-k">&gt;</span></pre></div>
<ul>
<li>java代码一样，只是where和if标签的写法有一点不同：由结果对比可知，生成的sql语句没有 1=1，更接近于真正的sql语句</li>
<li>由上面共同的java代码可知：在 <code class="notranslate">MyBatises.openSession()</code> 中并没有设置为true，也没有在后面手动提交事务，为什么？ 因为查询并不用提交事务，只有那些修改数据库数据的操作才会提交事务。</li>
</ul>
<h4><strong>4.批量处理</strong></h4>
<blockquote>
<p><strong>批量添加</strong></p>
</blockquote>
<p>xml</p>
<div class="highlight highlight-source-sql"><pre class="notranslate">    <span class="pl-k">&lt;</span>insert id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>batchInsert<span class="pl-pds">"</span></span>
            useGeneratedKeys<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>
            keyProperty<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
            parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>List<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">INSERT INTO</span> skill(name, level) <span class="pl-k">VALUES</span>
        <span class="pl-k">&lt;</span>!<span class="pl-c"><span class="pl-c">--</span> 遍历list数组，拿出里面全部的skill对象;separator表示分隔符, --&gt;</span>
        <span class="pl-k">&lt;</span>foreach collection<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> item<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>skill<span class="pl-pds">"</span></span> separator<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
            (<span class="pl-c"><span class="pl-c">#</span>{skill.name}, #{skill.level})</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>foreach<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>insert<span class="pl-k">&gt;</span></pre></div>
<p>java</p>
<div class="highlight highlight-source-java"><pre class="notranslate">    <span class="pl-c">// 批量添加</span>
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">batchInsert</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {

            <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-s1">skills</span> = <span class="pl-k">new</span> <span class="pl-smi">ArrayList</span>&lt;&gt;();
            <span class="pl-s1">skills</span>.<span class="pl-en">add</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"Java5"</span>, <span class="pl-c1">11</span>));
            <span class="pl-s1">skills</span>.<span class="pl-en">add</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"Java6"</span>, <span class="pl-c1">22</span>));
            <span class="pl-s1">skills</span>.<span class="pl-en">add</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"Java7"</span>, <span class="pl-c1">33</span>));
            <span class="pl-s1">skills</span>.<span class="pl-en">add</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"Java8"</span>, <span class="pl-c1">44</span>));
            <span class="pl-s1">skills</span>.<span class="pl-en">add</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"Java9"</span>, <span class="pl-c1">54</span>));
            <span class="pl-s1">skills</span>.<span class="pl-en">add</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"Java10"</span>, <span class="pl-c1">64</span>));

            <span class="pl-c">// 这里的insert是有一个int类型的返回值的，表示影响了多少条语句(上面表示影响了4条)</span>
            <span class="pl-s1">session</span>.<span class="pl-en">insert</span>(<span class="pl-s">"skill.batchInsert"</span>, <span class="pl-s1">skills</span>);

            <span class="pl-k">for</span> (<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> : <span class="pl-s1">skills</span>) {
                <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">skill</span>.<span class="pl-en">getId</span>());
            }

            <span class="pl-s1">session</span>.<span class="pl-en">commit</span>();
        }
    }</pre></div>
<blockquote>
<p><strong>批量删除</strong></p>
</blockquote>
<p>xml</p>
<div class="highlight highlight-source-sql"><pre class="notranslate">    <span class="pl-k">&lt;</span>!<span class="pl-c"><span class="pl-c">--</span>传进来的参数是List--&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">delete</span> id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>batchDelete<span class="pl-pds">"</span></span> parameterType<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>List<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">DELETE</span> <span class="pl-k">FROM</span> skill <span class="pl-k">WHERE</span> id <span class="pl-k">IN</span> (
        <span class="pl-k">&lt;</span>foreach collection<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> item<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> separator<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
            <span class="pl-c"><span class="pl-c">#</span>{id}</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>foreach<span class="pl-k">&gt;</span>
        )
    <span class="pl-k">&lt;</span><span class="pl-k">/</span><span class="pl-k">delete</span><span class="pl-k">&gt;</span>

    <span class="pl-k">&lt;</span>!<span class="pl-c"><span class="pl-c">--</span>传进来的参数是数组--&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">delete</span> id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>batchDelete2<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">DELETE</span> <span class="pl-k">FROM</span> skill <span class="pl-k">WHERE</span> id <span class="pl-k">IN</span>
        <span class="pl-k">&lt;</span>foreach collection<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>array<span class="pl-pds">"</span></span>
                 item<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
                 open<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>(<span class="pl-pds">"</span></span>
                 close<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>)<span class="pl-pds">"</span></span>
                 separator<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
            <span class="pl-c"><span class="pl-c">#</span>{id}</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>foreach<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span><span class="pl-k">delete</span><span class="pl-k">&gt;</span></pre></div>
<p>java</p>
<div class="highlight highlight-source-java"><pre class="notranslate">    <span class="pl-c">// 批量删除</span>
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">batchDelete</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {

	    <span class="pl-c">// List&lt;Integer&gt; ids = new ArrayList&lt;&gt;();</span>
	    <span class="pl-c">// ids.add(3);</span>
	    <span class="pl-c">// ids.add(7);</span>
	    <span class="pl-c">// ids.add(10);</span>
	    <span class="pl-c">// ids.add(11);</span>

            <span class="pl-smi">Integer</span>[] <span class="pl-s1">ids</span> = {<span class="pl-c1">3</span>, <span class="pl-c1">7</span>, <span class="pl-c1">10</span>, <span class="pl-c1">11</span>};

            <span class="pl-s1">session</span>.<span class="pl-en">insert</span>(<span class="pl-s">"skill.batchDelete2"</span>, <span class="pl-s1">ids</span>);

            <span class="pl-s1">session</span>.<span class="pl-en">commit</span>();
        }
    }</pre></div>
<p><strong>注意：</strong></p>
<ul>
<li>批量添加的效率比【多次单个添加】要高，但是它无法使用 <code class="notranslate">&lt;selectedKey&gt;</code> 获取新插入记录的主键，但可以使用 <code class="notranslate">useGeneratedKeys</code> 获取主键；</li>
<li>批量操作生成的SQL语句可能会比较长，有可能会超过数据库的限制；</li>
<li>如果传进来的参数是List，collection属性值为list就可以遍历这个Lisy;</li>
<li>如果传进来的参数是数组，collection属性值为array就可以遍历这个数组；</li>
<li><strong>如何解决批量操作生成的sql语句可能超过数据库限制的问题？</strong><br>
设置数据库的操作内存大小；分批次操作，如执行10000条生气了语句，可以分10次1000的操作。</li>
</ul>
<h2><strong>MyBatis的连接池-分页</strong></h2>
<h4><strong>1.设置Druid连接池</strong></h4>
<ul>
<li>若使用mybatis内置的连接池则用 <code class="notranslate">POLLED</code>，而想用第三方库 <code class="notranslate">Druid/C3PO</code> 等需要改变；</li>
<li>添加依赖druid，新建一个类并必须继承 <code class="notranslate">UnpooledDataSourceFactory</code> 这个mybatis内置类；</li>
<li>同时在构造方法中设置数据源 <code class="notranslate">datasource</code> :</li>
</ul>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-smi">DruidDataSourceFactory</span> <span class="pl-k">extends</span> <span class="pl-smi">UnpooledDataSourceFactory</span> {
    <span class="pl-k">public</span> <span class="pl-smi">DruidDataSourceFactory</span>() {
        <span class="pl-smi">this</span>.<span class="pl-s1">dataSource</span> = <span class="pl-k">new</span> <span class="pl-smi">DruidDataSource</span>();
    }
}</pre></div>
<ul>
<li>读取：第一在创建druid.properies文件配置属性，并在mybatis配置文件直接读取（<code class="notranslate">&lt;properties resource="druid.properties" /&gt;</code>）; 第二直接在mybatis配置文件中将POLLED换成DRUID，依次设置数据库以及连接的值。</li>
</ul>
<div class="highlight highlight-source-java"><pre class="notranslate">	#<span class="pl-smi">druid</span>.<span class="pl-smi">properties</span>

	<span class="pl-s1">dev</span>.<span class="pl-s1">driverClass</span>=<span class="pl-smi">com</span>.<span class="pl-smi">mysql</span>.<span class="pl-smi">jdbc</span>.<span class="pl-smi">Driver</span>
	<span class="pl-s1">dev</span>.<span class="pl-s1">url</span>=<span class="pl-s1">jdbc</span>:<span class="pl-s1">mysql</span>:<span class="pl-c">//localhost:3306/test_mybatis</span>
	<span class="pl-s1">dev</span>.<span class="pl-s1">username</span>=<span class="pl-smi">root</span>
	<span class="pl-s1">dev</span>.<span class="pl-s1">password</span>=<span class="pl-smi">root</span>
	<span class="pl-s1">dev</span>.<span class="pl-s1">initialSize</span>=<span class="pl-c1">5</span>
	<span class="pl-s1">dev</span>.<span class="pl-s1">maxActive</span>=<span class="pl-c1">10</span>
	<span class="pl-s1">dev</span>.<span class="pl-s1">maxWait</span>=<span class="pl-c1">5000</span></pre></div>
<div class="highlight highlight-source-java"><pre class="notranslate">    <span class="pl-c">// mybatis-config.xml</span>

    &lt;<span class="pl-s1">properties</span> <span class="pl-s1">resource</span>=<span class="pl-s">"druid.properties"</span> /&gt;
    &lt;<span class="pl-smi">environments</span> <span class="pl-s1">default</span>=<span class="pl-s">"development"</span>&gt;
        &lt;!-- <span class="pl-s1">开发环境</span>（<span class="pl-s1">调试阶段3</span>） --&gt;
        &lt;<span class="pl-smi">environment</span> <span class="pl-s1">id</span>=<span class="pl-s">"development"</span>&gt;
            &lt;!-- <span class="pl-s1">采用JDBC的事务管理方法</span> --&gt;
            &lt;<span class="pl-smi">transactionManager</span> <span class="pl-s1">type</span>=<span class="pl-s">"JDBC"</span> /&gt;

            &lt;!-- <span class="pl-s1">POOLED代表采取连接池的方式管理连接</span> --&gt;
            &lt;<span class="pl-smi">dataSource</span> <span class="pl-s1">type</span>=<span class="pl-s">"DRUID"</span>&gt;
                &lt;<span class="pl-smi">property</span> <span class="pl-s1">name</span>=<span class="pl-s">"driverClass"</span> <span class="pl-s1">value</span>=<span class="pl-s">"${dev.driverClass}"</span>/&gt;
                &lt;<span class="pl-smi">property</span> <span class="pl-s1">name</span>=<span class="pl-s">"url"</span> <span class="pl-s1">value</span>=<span class="pl-s">"${dev.url}"</span>/&gt;
                &lt;<span class="pl-smi">property</span> <span class="pl-s1">name</span>=<span class="pl-s">"username"</span> <span class="pl-s1">value</span>=<span class="pl-s">"${dev.username}"</span>/&gt;
                &lt;<span class="pl-smi">property</span> <span class="pl-s1">name</span>=<span class="pl-s">"password"</span> <span class="pl-s1">value</span>=<span class="pl-s">"${dev.password}"</span>/&gt;
                &lt;<span class="pl-smi">property</span> <span class="pl-s1">name</span>=<span class="pl-s">"initialSize"</span> <span class="pl-s1">value</span>=<span class="pl-s">"${dev.initialSize}"</span>/&gt;
                &lt;<span class="pl-smi">property</span> <span class="pl-s1">name</span>=<span class="pl-s">"maxActive"</span> <span class="pl-s1">value</span>=<span class="pl-s">"${dev.maxActive}"</span>/&gt;
                &lt;<span class="pl-smi">property</span> <span class="pl-s1">name</span>=<span class="pl-s">"maxWait"</span> <span class="pl-s1">value</span>=<span class="pl-s">"${dev.maxWait}"</span>/&gt;
            &lt;/<span class="pl-s1">dataSource</span>&gt;
        &lt;/<span class="pl-s1">environment</span>&gt;
    &lt;/<span class="pl-s1">environments</span>&gt;</pre></div>
<ul>
<li>通过以上操作，把类名设置到dataSource的Type属性上，然后拿到这个 <code class="notranslate">DruidDataSourceFactory</code> 并创建这个工厂，创建完后就去读取配置文件中的property属性配置信息，最终会将配置信息设置到前面的datasource上去；</li>
</ul>
<h4><strong>2.分页</strong></h4>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918173005-c0502a19f19f4098841701b20f4abb4b.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210918173005-c0502a19f19f4098841701b20f4abb4b.png" alt="QQ图片20210918173005.png" style="max-width: 100%;"></a></p>
<blockquote>
<p>每个数据库的分页查询语句都不太一样，所以采用PageHelper这个mybatis分页插件，支持多种数据库并简化分页的业务逻辑。</p>
</blockquote>
<blockquote>
<p>解析上图Oracle的查询思路：①先把student里的所有属性，如id、name等查询出来（假设总共数据有30条）；②中间这个第二层select就是为了给30条数据加上行号rn，并筛选出小于20的数据（1<del>20）；③最外层的select就是对rn大于等于11的筛查，得到11</del>20的数据。这中方法三次select，效率低！</p>
</blockquote>
<p><strong>为了屏蔽每种数据库执行语句的不同，是代码更具有健壮性，将使用mybatis分页插件 <code class="notranslate">PageHelper</code>，它支持多种常用的数据库，可以极大简化分页的业务逻辑。如何使用？</strong></p>
<ul>
<li>添加依赖</li>
<li>在mybatis-config.xml中配置插件</li>
</ul>
<div class="highlight highlight-text-xml"><pre class="notranslate">    <span class="pl-c"><span class="pl-c">&lt;!--</span> MyBatis分页插件 <span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">plugins</span>&gt;
        &lt;<span class="pl-ent">plugin</span> <span class="pl-e">interceptor</span>=<span class="pl-s"><span class="pl-pds">"</span>com.github.pagehelper.PageInterceptor<span class="pl-pds">"</span></span>&gt;
            <span class="pl-c"><span class="pl-c">&lt;!--</span> true代表分页合理化：pageNum &lt;= 0就会自动获取第1页，pageNum &gt; pages就会自动获取最后1页 <span class="pl-c">--&gt;</span></span>
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>reasonable<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">plugin</span>&gt;
    &lt;/<span class="pl-ent">plugins</span>&gt;</pre></div>
<ul>
<li>使用方法：直接查询第2页的5条数据，即 6~10</li>
</ul>
<div class="highlight highlight-source-java"><pre class="notranslate">    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">page</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-smi">PageHelper</span>.<span class="pl-en">startPage</span>(<span class="pl-c1">2</span>, <span class="pl-c1">5</span>);
            <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-s1">skills</span> = <span class="pl-s1">session</span>.<span class="pl-en">selectList</span>(<span class="pl-s">"skill.list"</span>);
            <span class="pl-k">for</span> (<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> : <span class="pl-s1">skills</span>) {
                <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">skill</span>);
            }
        }
    }</pre></div>
<h2><strong>MyBatis的多表查询与延迟加载</strong></h2>
<h3><strong>1.多表查询</strong></h3>
<ul>
<li>数据库的表之间可能存在一定的关系：一对多\多对一、一对一、多对多</li>
</ul>
<blockquote>
<p><strong>多表关系：一对一（一个人对应一张身份证，反之一样）</strong></p>
</blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919091702-fed5228c74774da3a28c498e18ee2fb6.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919091702-fed5228c74774da3a28c498e18ee2fb6.png" alt="QQ图片20210919091702.png" style="max-width: 100%;"></a></p>
<blockquote>
<p><strong>多表关系：一对多\多对一（一个人对应多张银行卡）</strong></p>
</blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919091552-c6760435bae34863b1f1c0c4f23144c7.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919091552-c6760435bae34863b1f1c0c4f23144c7.png" alt="QQ图片20210919091552.png" style="max-width: 100%;"></a></p>
<blockquote>
<p><strong>多表关系：多对多（多个人对应多个工作岗位）</strong></p>
</blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919092329-6a6b2201339243bcb41a2a2909ccc2c9.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919092329-6a6b2201339243bcb41a2a2909ccc2c9.png" alt="QQ图片20210919092329.png" style="max-width: 100%;"></a></p>
<ul>
<li>多表之间的xml映射关系：</li>
</ul>
<p>person.xml（只是是用person去关联身份证、银行卡以及工作）</p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span> ?&gt;
&lt;!<span class="pl-ent">DOCTYPE</span> <span class="pl-e">mapper</span>
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;<span class="pl-ent">mapper</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">sql</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>&gt;
        SELECT
            p.*,
            ic.id id_card_id,
            ic.no id_card_no,
            ic.address id_card_address,
            bc.id bank_card_id,
            bc.no bank_card_no,
            bc.amout bank_card_amout,
            j.id job_id,
            j.name job_name,
            j.duty job_duty
        FROM
            person p
        <span class="pl-c"><span class="pl-c">&lt;!--</span>这里的idcard不用左连接，直接内连接，因为每一个人只有一个身份证<span class="pl-c">--&gt;</span></span>
        JOIN id_card ic ON p.id = ic.person_id
        LEFT JOIN bank_card bc ON p.id = bc.person_id
        LEFT JOIN person_job pj ON p.id = pj.person_id
        LEFT JOIN job j ON j.id = pj.job_id
    &lt;/<span class="pl-ent">sql</span>&gt;

    <span class="pl-c"><span class="pl-c">&lt;!--</span>字段映射<span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">resultMap</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Person<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>/&gt;
        <span class="pl-c"><span class="pl-c">&lt;!--</span>idCard的映射<span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">association</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>idCard<span class="pl-pds">"</span></span>
                     <span class="pl-e">javaType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.IdCard<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id_card_id<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>no<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id_card_no<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id_card_address<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">association</span>&gt;
        <span class="pl-c"><span class="pl-c">&lt;!--</span>bankCards的映射<span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">collection</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>bankCards<span class="pl-pds">"</span></span> <span class="pl-e">ofType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.BankCard<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>bank_card_id<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>no<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>bank_card_no<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>amout<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>bank_card_amout<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">collection</span>&gt;
        <span class="pl-c"><span class="pl-c">&lt;!--</span>jobs的映射<span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">collection</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>jobs<span class="pl-pds">"</span></span> <span class="pl-e">ofType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Job<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>job_id<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>job_name<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>duty<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>job_duty<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">collection</span>&gt;
    &lt;/<span class="pl-ent">resultMap</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>get<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt; WHERE p.id = #{id}
    &lt;/<span class="pl-ent">select</span>&gt;
&lt;/<span class="pl-ent">mapper</span>&gt;</pre></div>
<p><strong>注意：</strong></p>
<ul>
<li>在一对一关系中，字段映射时使用标签 <code class="notranslate">&lt;association/&gt;</code>，而一对多、多对多是使用 <code class="notranslate">&lt;collection/&gt;</code>，因为一对多、多对多产生的数据是集合了。</li>
<li>特别注意字段映射时自己的属性与关联表的属性的映射格式写法。</li>
<li>对数据库操作的MyBatis和上节是一样的：这里需要在下面配置所有的实体映射文件的路径！</li>
</ul>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span> ?&gt;
&lt;!<span class="pl-ent">DOCTYPE</span> <span class="pl-e">configuration</span>
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;<span class="pl-ent">configuration</span>&gt;
    &lt;<span class="pl-ent">properties</span> <span class="pl-e">resource</span>=<span class="pl-s"><span class="pl-pds">"</span>druid.properties<span class="pl-pds">"</span></span> /&gt;

    <span class="pl-c"><span class="pl-c">&lt;!--</span> 其他设置 <span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">settings</span>&gt;
        <span class="pl-c"><span class="pl-c">&lt;!--</span> 数据库：my_first_name -&gt; Java：myFirstName <span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">setting</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>mapUnderscoreToCamelCase<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">settings</span>&gt;

    <span class="pl-c"><span class="pl-c">&lt;!--</span> 别名 <span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">typeAliases</span>&gt;
        <span class="pl-c"><span class="pl-c">&lt;!--</span> 一旦设置了别名，它是不区分大小写的 <span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">typeAlias</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.common.DruidDataSourceFactory<span class="pl-pds">"</span></span> <span class="pl-e">alias</span>=<span class="pl-s"><span class="pl-pds">"</span>druid<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">typeAliases</span>&gt;

    <span class="pl-c"><span class="pl-c">&lt;!--</span> 环境 <span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">environments</span> <span class="pl-e">default</span>=<span class="pl-s"><span class="pl-pds">"</span>development<span class="pl-pds">"</span></span>&gt;
        <span class="pl-c"><span class="pl-c">&lt;!--</span> 开发环境（调试阶段） <span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">environment</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>development<span class="pl-pds">"</span></span>&gt;
            <span class="pl-c"><span class="pl-c">&lt;!--</span> 采用JDBC的事务管理方法 <span class="pl-c">--&gt;</span></span>
            &lt;<span class="pl-ent">transactionManager</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>JDBC<span class="pl-pds">"</span></span> /&gt;

            <span class="pl-c"><span class="pl-c">&lt;!--</span> POOLED代表采取连接池的方式管理连接 <span class="pl-c">--&gt;</span></span>
            &lt;<span class="pl-ent">dataSource</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>DRUID<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>driverClass<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${dev.driverClass}<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>url<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${dev.url}<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>username<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${dev.username}<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${dev.password}<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>initialSize<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${dev.initialSize}<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>maxActive<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${dev.maxActive}<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>maxWait<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${dev.maxWait}<span class="pl-pds">"</span></span>/&gt;
            &lt;/<span class="pl-ent">dataSource</span>&gt;
        &lt;/<span class="pl-ent">environment</span>&gt;
    &lt;/<span class="pl-ent">environments</span>&gt;

    <span class="pl-c"><span class="pl-c">&lt;!--</span> 添加实体映射文件的路径 <span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">mappers</span>&gt;
        &lt;<span class="pl-ent">mapper</span> <span class="pl-e">resource</span>=<span class="pl-s"><span class="pl-pds">"</span>mappers/person.xml<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">mapper</span> <span class="pl-e">resource</span>=<span class="pl-s"><span class="pl-pds">"</span>mappers/idCard.xml<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">mapper</span> <span class="pl-e">resource</span>=<span class="pl-s"><span class="pl-pds">"</span>mappers/bankCard.xml<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">mapper</span> <span class="pl-e">resource</span>=<span class="pl-s"><span class="pl-pds">"</span>mappers/job.xml<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">mappers</span>&gt;
&lt;/<span class="pl-ent">configuration</span>&gt;</pre></div>
<h4><strong>反过来：可以用person去关联其他表，也可以分别用其他表去关联person</strong></h4>
<p>idCard</p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;<span class="pl-ent">mapper</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>idCard<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">sql</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>&gt;
        SELECT
            ic.*,
            p.name person_name
        FROM
            id_card ic
        JOIN person p ON p.id = ic.person_id
    &lt;/<span class="pl-ent">sql</span>&gt;

    <span class="pl-c"><span class="pl-c">&lt;!--</span>    映射<span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">resultMap</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.IdCard<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>no<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>no<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">association</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span> <span class="pl-e">javaType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Person<span class="pl-pds">"</span></span>&gt; <span class="pl-c"><span class="pl-c">&lt;!--</span>关联标签<span class="pl-c">--&gt;</span></span>
            &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>person_id<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>person_name<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">association</span>&gt;
    &lt;/<span class="pl-ent">resultMap</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">include</span>&gt;
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>get<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt; WHERE ic.id = #{id}
    &lt;/<span class="pl-ent">select</span>&gt;</pre></div>
<p>bankCard</p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;<span class="pl-ent">mapper</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>bankCard<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">sql</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>&gt;
        SELECT
            bc.*,
            p.name person_name
        FROM
            bank_card bc
        JOIN person p ON p.id = bc.person_id
    &lt;/<span class="pl-ent">sql</span>&gt;

    &lt;<span class="pl-ent">resultMap</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.BankCard<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>no<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>no<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>amout<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>amout<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">association</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span> <span class="pl-e">javaType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Person<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>person_id<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>person_name<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">association</span>&gt;
    &lt;/<span class="pl-ent">resultMap</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>get<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt; WHERE bc.id = #{id}
    &lt;/<span class="pl-ent">select</span>&gt;
&lt;/<span class="pl-ent">mapper</span>&gt;</pre></div>
<p>job</p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;<span class="pl-ent">mapper</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>job<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">sql</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>&gt;
        SELECT
            j.*,
            p.id person_id,
            p.name person_name
        FROM
            job j
        LEFT JOIN person_job pj ON j.id = pj.job_id
        LEFT JOIN person p ON p.id = pj.person_id
    &lt;/<span class="pl-ent">sql</span>&gt;

    &lt;<span class="pl-ent">resultMap</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Job<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>duty<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>duty<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">collection</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>persons<span class="pl-pds">"</span></span> <span class="pl-e">ofType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Person<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>person_id<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>person_name<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">collection</span>&gt;
    &lt;/<span class="pl-ent">resultMap</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>get<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt; WHERE j.id = #{id}
    &lt;/<span class="pl-ent">select</span>&gt;
&lt;/<span class="pl-ent">mapper</span>&gt;</pre></div>
<p>测试java代码：多对一与多对多也是同样的</p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-smi">OneToOne</span> {
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">personList</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-smi">List</span>&lt;<span class="pl-smi">Person</span>&gt; <span class="pl-s1">persons</span> = <span class="pl-s1">session</span>.<span class="pl-en">selectList</span>(<span class="pl-s">"person.list"</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">persons</span>);
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">personGet</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-smi">Person</span> <span class="pl-s1">person</span> = <span class="pl-s1">session</span>.<span class="pl-en">selectOne</span>(<span class="pl-s">"person.get"</span>, <span class="pl-c1">1</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">person</span>);
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">idCardList</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-smi">List</span>&lt;<span class="pl-smi">IdCard</span>&gt; <span class="pl-s1">idCards</span> = <span class="pl-s1">session</span>.<span class="pl-en">selectList</span>(<span class="pl-s">"idCard.list"</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">idCards</span>);
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">idCardGet</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-smi">IdCard</span> <span class="pl-s1">idCard</span> = <span class="pl-s1">session</span>.<span class="pl-en">selectOne</span>(<span class="pl-s">"idCard.get"</span>, <span class="pl-c1">1</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">idCard</span>);
        }
    }
}</pre></div>
<h3><strong>2.延迟加载</strong></h3>
<blockquote>
<p><strong>由上面的一对多、多对多中的banlCard与job可知：会存在一个人对应多张银行卡和职业，如果每次直接全部查出十分耗费资源，希望只是在需要的时候查询出想要的部分结果比较好！</strong></p>
</blockquote>
<ul>
<li>关联对象（association、collection）可以实现延迟加载。</li>
<li>实现延迟加载的步骤，还需要设置以下属性：<code class="notranslate">fetchType:</code> 设置为lazy；<code class="notranslate">select：</code>指定一个select标签的id，用于查询需要延迟加载的记录；<code class="notranslate">column：</code>指定一个列的值，作为调用select查询时传入的参数值；在很多时候，都会给 <code class="notranslate">collection</code> 设置延迟加载</li>
<li>延迟加载一般分为全局延迟加载和局部延迟加载：</li>
</ul>
<p><strong>全局延迟加载开关</strong></p>
<ul>
<li>全局延迟加载开关，在mybatis-config.xml的setting中配置;</li>
</ul>
<div class="highlight highlight-text-xml"><pre class="notranslate">    <span class="pl-c"><span class="pl-c">&lt;!--</span> 其他设置 <span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">settings</span>&gt;
	<span class="pl-c"><span class="pl-c">&lt;!--</span> true代表所有设置了select属性的关联对象都延迟加载 <span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">setting</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>lazyLoadingEnabled<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">settings</span>&gt;

    <span class="pl-c"><span class="pl-c">&lt;!--</span>true:所有设置了select属性的关联对象默认懒加载，但可以通过fetchType覆盖这个全局设置<span class="pl-c">--&gt;</span></span></pre></div>
<p><strong>局部延迟加载开关</strong></p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span> ?&gt;
&lt;!<span class="pl-ent">DOCTYPE</span> <span class="pl-e">mapper</span>
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;<span class="pl-ent">mapper</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">sql</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>&gt;
        SELECT * FROM person
    &lt;/<span class="pl-ent">sql</span>&gt;

    &lt;<span class="pl-ent">resultMap</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Person<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">id</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">result</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">association</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>idCard<span class="pl-pds">"</span></span>
                     <span class="pl-e">fetchType</span>=<span class="pl-s"><span class="pl-pds">"</span>lazy<span class="pl-pds">"</span></span>
                     <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
                     <span class="pl-e">select</span>=<span class="pl-s"><span class="pl-pds">"</span>idCard.getByPerson<span class="pl-pds">"</span></span>
                     <span class="pl-e">javaType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.IdCard<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">collection</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>bankCards<span class="pl-pds">"</span></span>
                    <span class="pl-e">fetchType</span>=<span class="pl-s"><span class="pl-pds">"</span>lazy<span class="pl-pds">"</span></span>
                    <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
                    <span class="pl-e">select</span>=<span class="pl-s"><span class="pl-pds">"</span>bankCard.listByPerson<span class="pl-pds">"</span></span>
                    <span class="pl-e">ofType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.BankCard<span class="pl-pds">"</span></span>/&gt;
        &lt;<span class="pl-ent">collection</span> <span class="pl-e">property</span>=<span class="pl-s"><span class="pl-pds">"</span>jobs<span class="pl-pds">"</span></span>
                    <span class="pl-e">fetchType</span>=<span class="pl-s"><span class="pl-pds">"</span>lazy<span class="pl-pds">"</span></span>
                    <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
                    <span class="pl-e">select</span>=<span class="pl-s"><span class="pl-pds">"</span>job.listByPerson<span class="pl-pds">"</span></span>
                    <span class="pl-e">ofType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Job<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">resultMap</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>get<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmList<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt; WHERE id = #{id}
    &lt;/<span class="pl-ent">select</span>&gt;
&lt;/<span class="pl-ent">mapper</span>&gt;</pre></div>
<p><strong>注意：</strong> 以上代码就是在各自xml中实现全部延迟加载，但就算在mybatis的配置文件中设置了全部延迟加载，在各自的映射文件中也可以用 <code class="notranslate">fetchType="eager"</code> 进行覆盖。 <strong>在很多时候，都会给 <code class="notranslate">collection</code> 设置延迟加载</strong>。</p>
<h2><strong>MyBatis的缓存与构造方法</strong></h2>
<h3><strong>1.缓存</strong></h3>
<blockquote>
<p><strong>缓存是指为了减少数据库直接访问次数、提高访问效率，而临时存储在内存中的数据；</strong></p>
</blockquote>
<blockquote>
<p><strong>适合存放到缓存中的数据是经常查询、不经常改变、数据的正确性对最终结果影响不大；</strong></p>
</blockquote>
<blockquote>
<p><strong>举例一些不适合放到缓存中的数据：商品库存、股票 黄金的价格、汇率；</strong></p>
</blockquote>
<blockquote>
<p><strong>MyBatis的缓存分为一级缓存、二级缓存，用于缓存select的结果；</strong></p>
</blockquote>
<blockquote>
<p><strong>缓存中的信息并没有数据库的数据新；</strong></p>
</blockquote>
<h4><strong>为什么要使用缓存？</strong></h4>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919104847-53faa5409e65496bb002c909bd8c2d5d.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919104847-53faa5409e65496bb002c909bd8c2d5d.png" alt="QQ图片20210919104847.png" style="max-width: 100%;"></a></p>
<h4><strong>为什么从缓存中获取信息更快？</strong></h4>
<p>因为缓存的信息是存储在内存中的，而数据库文件信息是存储在硬盘中，常识可知内存比访问硬盘的速度更快！</p>
<h4><strong>测试代码结构</strong></h4>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919105150-3c524ea30a94404891f09e37f90a0f86.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919105150-3c524ea30a94404891f09e37f90a0f86.png" alt="QQ图片20210919105150.png" style="max-width: 100%;"></a></p>
<blockquote>
<p><strong>一级缓存是存放到了 <code class="notranslate">SqlSession</code> 对象中：由于 mybatis 的自动启动一级缓存，所以同一个Session拿到的数据的内存地址是一样的，即同一个 <code class="notranslate">SqlSession</code> 的<code class="notranslate">select</code>共享缓存，使用关闭 <code class="notranslate">SqlSession</code> 时，缓存也失效了；执行 <code class="notranslate">insert</code>、<code class="notranslate">update</code>、<code class="notranslate">delete</code>、<code class="notranslate">commit</code>等方法时，会自动清理一级缓存，由于在很多时候，每次查询用的都是不同的<code class="notranslate">SqlSession</code>，所以一级缓存的命中率并不高。</strong></p>
</blockquote>
<blockquote>
<p><strong>为了提高缓存的命中率，可以考虑开启MyBatis的二级缓存，它是<code class="notranslate">namespace（mapper）</code>级别的缓存，同一个namespace下的select共享缓存，默认情况namespace下<code class="notranslate">insert</code>、<code class="notranslate">update</code>、<code class="notranslate">delete</code>执行成功时，会自动清理二级缓存，当调用的 <code class="notranslate">SqlSession</code> 方法 <code class="notranslate">close</code> 时，会将查询结果放进二级缓存。</strong></p>
</blockquote>
<blockquote>
<p><strong>可以理解为一级缓存是存储在Session中，而二级缓存是存在sqlSessionFactory全局唯一份。</strong></p>
</blockquote>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;<span class="pl-ent">mapper</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>job<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">cache</span> <span class="pl-e">readOnly</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>/&gt;

    &lt;<span class="pl-ent">sql</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>&gt;
        SELECT * FROM job
    &lt;/<span class="pl-ent">sql</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> <span class="pl-e">resultType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Job<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>get<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">resultType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Job<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlListAll<span class="pl-pds">"</span></span>/&gt; WHERE id = #{id}
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">update</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>update<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.bean.Job<span class="pl-pds">"</span></span>&gt;
        UPDATE job SET name = #{name}, duty = #{duty} WHERE id = #{id}
    &lt;/<span class="pl-ent">update</span>&gt;
&lt;/<span class="pl-ent">mapper</span>&gt;</pre></div>
<p>由上可知：</p>
<ul>
<li>一级缓存是子标签 <code class="notranslate">&lt;select/&gt;</code> 级别的，重新开启一个session查询（<code class="notranslate">MyBatises.openSession()</code>）时，同一个select是不能在缓存中拿到的。</li>
<li>而二级缓存是namespace级别的（根标签），就算重新打开一个session，再重新查询其里面的同一个select是可以在缓存中拿到的，提高了缓存的命中率。</li>
</ul>
<h4><strong>开启二级缓存</strong></h4>
<ol>
<li>在mybatis-config.xml中配置</li>
</ol>
<div class="highlight highlight-text-xml"><pre class="notranslate">    <span class="pl-c"><span class="pl-c">&lt;!--</span> 其他设置 <span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">settings</span>&gt;
        <span class="pl-c"><span class="pl-c">&lt;!--</span> 开启二级缓存 <span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">setting</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>cacheEnabled<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">settings</span>&gt;</pre></div>
<ol start="2">
<li>在映射文件的 <code class="notranslate">mapper</code> 中添加 <code class="notranslate">cache</code> 标签，默认会缓存映射文件中的所有 <code class="notranslate">select</code> 的结果：在上图xml代码中可以看见</li>
</ol>
<div class="highlight highlight-text-xml"><pre class="notranslate">    &lt;<span class="pl-ent">cache</span> <span class="pl-e">readOnly</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>/&gt;

    <span class="pl-c"><span class="pl-c">&lt;!--</span></span>
<span class="pl-c">       cache标签的常用属性有：</span>
<span class="pl-c">	  size:缓存多少个存储结果（单个对象或一个列表）的引用，默认值是1024；</span>
<span class="pl-c">	  eviction:当缓存数量超过size时的清除策略。可选值有LRU（默认值，最近最少使用）、FIFO、SOFT、WEAK；</span>
<span class="pl-c">	  flushInterval:每隔多少毫秒清除一次缓存，默认不会定时清除缓存；</span>
<span class="pl-c">	  readOnly: true代表缓存的是对原对象的引用，false代表缓存的是原对象序列化后的拷贝对象，所以false时要求实现Serializable接口。默认值是false；</span>
<span class="pl-c">   <span class="pl-c">--&gt;</span></span></pre></div>
<blockquote>
<p><strong>注意： 在对应映射文件添加 cache 标签，其中属性有 <code class="notranslate">size（缓存多少个存储结果）</code>、<code class="notranslate">eviction（超过size后的清楚策略，默认LRU，重要）</code>、<code class="notranslate">flushInterval、readOnly</code>，其中 <code class="notranslate">readOnly</code> 属性值为 true/false，默认为false，设置为true表示是对原对象的引用，后面拿到的都是这一个不变的内存地址，这样是不安全的：若后面对其进行了修改，就会直接修改二级缓存中的内容，而false不是对原对象的引用，而先会对原对象进行 <code class="notranslate">序列化</code>，则后面的其他sqlSession拿到的都是对象反序列化生成的，虽然这样拿到的不是同一个内存地址，但还是只访问了一次数据库（false只需在bean中设置可实现序列化，实现接口Serializable）</strong>；</p>
</blockquote>
<ol start="3">
<li>当然了，我们也可以通过属性设置来解决哪些要开启二级缓存！</li>
</ol>
<ul>
<li>可以通过设置 <code class="notranslate">useCache</code> 属性来决定某个select是否需要开启二级缓存；</li>
<li>可以通过设置 <code class="notranslate">flushCache</code> 属性来决定某个操作之后，是否需要清除缓存；<br>
<a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919142101-75f81854d6e7436892ef0e068b64f448.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919142101-75f81854d6e7436892ef0e068b64f448.png" alt="QQ图片20210919142101.png" style="max-width: 100%;"></a></li>
<li>上述代码表示：在sava操作之后，<code class="notranslate">flushCache="false"</code> 不会清楚缓存；</li>
</ul>
<p><strong>注意：</strong> 在我们的上一个知识点延迟加载中说到：就算在全局延迟加载开关在mybatis-config.xml中配置了全部延迟加载，但也是可以在各自映射文件中用 <code class="notranslate">fetchType="eager"</code> 来进行覆盖这个全局延迟加载，从而设置为立即加载。 而在这里却不行，如果你关闭了全局二级缓存在 mybatis-config.xml 中设置 <code class="notranslate">&lt;setting name="cacheEnabled" value="false"/&gt;</code> ，而就算在各自映射文件的 select中 设置 <code class="notranslate">useCache=true</code> 也是不能特殊打开二级缓存的。</p>
<h3><strong>2.构造方法</strong></h3>
<blockquote>
<p>指定构造方法1</p>
</blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919143704-98035be753764cadbee4265735016001.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919143704-98035be753764cadbee4265735016001.png" alt="QQ图片20210919143704.png" style="max-width: 100%;"></a></p>
<blockquote>
<p>指定构造方法2</p>
</blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919143707-7952d44dae044619a663de2a26354b35.png"><img src="/upload/2021/09/QQ%E5%9B%BE%E7%89%8720210919143707-7952d44dae044619a663de2a26354b35.png" alt="QQ图片20210919143707.png" style="max-width: 100%;"></a></p>
<h2><strong>MyBatis的Dao</strong></h2>
<blockquote>
<p><strong>使用MyBatis实现Dao层的几种方式?</strong></p>
</blockquote>
<blockquote>
<ol>
<li><strong>自定义dao实现类，在实现中调用SqlSession的相关方法（使用XML）</strong></li>
<li><strong>只定义dao接口类，SqlSession的getMapper方法生成dao的代理对象（使用XML）</strong></li>
<li><strong>只定义dao接口类，SqlSession的getMapper方法生成dao的代理对象（使用注解）</strong></li>
</ol>
</blockquote>
<h4><strong>1.自定义dao实现类，在实现中调用SqlSession的相关方法（使用XML）</strong></h4>
<p><strong>创建dao接口</strong></p>
<div class="highlight highlight-source-java"><pre class="notranslate">     <span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-smi">SkillDao</span> {
    	   <span class="pl-smi">boolean</span> <span class="pl-en">save</span>(<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span>);
    	   <span class="pl-smi">boolean</span> <span class="pl-en">update</span>(<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span>);
    	   <span class="pl-smi">boolean</span> <span class="pl-en">remove</span>(<span class="pl-smi">Integer</span> <span class="pl-s1">id</span>);
    	   <span class="pl-smi">Skill</span> <span class="pl-en">get</span>(<span class="pl-smi">Integer</span> <span class="pl-s1">id</span>);
    	   <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-en">list</span>();
     }</pre></div>
<p><strong>在xxxDaoImpl中具体实现：这里实际就是调用映射文件中的sql语句</strong></p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-smi">SkillDaoImpl</span> <span class="pl-k">implements</span> <span class="pl-smi">SkillDao</span> {
    <span class="pl-c1">@</span><span class="pl-c1">Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">boolean</span> <span class="pl-en">save</span>(<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span>) {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-k">return</span> <span class="pl-s1">session</span>.<span class="pl-en">insert</span>(<span class="pl-s">"skill.save"</span>, <span class="pl-s1">skill</span>) &gt; <span class="pl-c1">0</span>; <span class="pl-c">// 传入skill对象用于保存</span>
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">boolean</span> <span class="pl-en">update</span>(<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span>) {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-k">return</span> <span class="pl-s1">session</span>.<span class="pl-en">update</span>(<span class="pl-s">"skill.update"</span>, <span class="pl-s1">skill</span>) &gt; <span class="pl-c1">0</span>;
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">boolean</span> <span class="pl-en">remove</span>(<span class="pl-smi">Integer</span> <span class="pl-s1">id</span>) {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-k">return</span> <span class="pl-s1">session</span>.<span class="pl-en">delete</span>(<span class="pl-s">"skill.remove"</span>, <span class="pl-s1">id</span>) &gt; <span class="pl-c1">0</span>;
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">Skill</span> <span class="pl-en">get</span>(<span class="pl-smi">Integer</span> <span class="pl-s1">id</span>) {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-k">return</span> <span class="pl-s1">session</span>.<span class="pl-en">selectOne</span>(<span class="pl-s">"skill.get"</span>, <span class="pl-s1">id</span>);
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-en">list</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-k">return</span> <span class="pl-s1">session</span>.<span class="pl-en">selectList</span>(<span class="pl-s">"skill.list"</span>);
        }
    }
}</pre></div>
<p><strong>则在映射文件中的sql语句实现</strong></p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span> ?&gt;
&lt;!<span class="pl-ent">DOCTYPE</span> <span class="pl-e">mapper</span>
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;<span class="pl-ent">mapper</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>skill<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">sql</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlList<span class="pl-pds">"</span></span>&gt;SELECT * FROM skill&lt;/<span class="pl-ent">sql</span>&gt;

<span class="pl-c"><span class="pl-c">&lt;!--</span>    resultType="Skill"中的Skill是别名："com.ws.bean.Skill"<span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>get<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">resultType</span>=<span class="pl-s"><span class="pl-pds">"</span>Skill<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlList<span class="pl-pds">"</span></span>/&gt; WHERE id = #{id}
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> <span class="pl-e">resultType</span>=<span class="pl-s"><span class="pl-pds">"</span>Skill<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlList<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">update</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>update<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>Skill<span class="pl-pds">"</span></span>&gt;
        UPDATE skill SET name = #{name}, level = #{level} WHERE id = #{id}
    &lt;/<span class="pl-ent">update</span>&gt;

    &lt;<span class="pl-ent">insert</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>save<span class="pl-pds">"</span></span>
            <span class="pl-e">useGeneratedKeys</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> <span class="pl-e">keyProperty</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
            <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>Skill<span class="pl-pds">"</span></span>&gt;
        INSERT INTO skill(name, level) VALUES(#{name}, #{level})
    &lt;/<span class="pl-ent">insert</span>&gt;

    &lt;<span class="pl-ent">delete</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>remove<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span>&gt;
        DELETE FROM skill WHERE id = #{id}
    &lt;/<span class="pl-ent">delete</span>&gt;
&lt;/<span class="pl-ent">mapper</span>&gt;</pre></div>
<h4><strong>测试代码</strong></h4>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-smi">SkillTest</span> {
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">get</span>() {
        <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-k">new</span> <span class="pl-smi">SkillDaoImpl</span>();
        <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">dao</span>.<span class="pl-en">get</span>(<span class="pl-c1">2</span>));
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">list</span>() {
        <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-k">new</span> <span class="pl-smi">SkillDaoImpl</span>();
        <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">dao</span>.<span class="pl-en">list</span>());
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">save</span>() {
        <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-k">new</span> <span class="pl-smi">SkillDaoImpl</span>();
        <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">save</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"mj888"</span>, <span class="pl-c1">100</span>)));
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">update</span>() {
        <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-k">new</span> <span class="pl-smi">SkillDaoImpl</span>();
        <span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> = <span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"666"</span>, <span class="pl-c1">99</span>);
        <span class="pl-s1">skill</span>.<span class="pl-en">setId</span>(<span class="pl-c1">16</span>);
        <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">update</span>(<span class="pl-s1">skill</span>));
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">remove</span>() {
        <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-k">new</span> <span class="pl-smi">SkillDaoImpl</span>();
        <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">remove</span>(<span class="pl-c1">19</span>));
    }
}</pre></div>
<blockquote>
<p><strong>特别需要注意两者之间的标签对应：<code class="notranslate">select标签 -&gt; get/list</code>、<code class="notranslate">update标签 -&gt; update</code>、<code class="notranslate">insert标签 -&gt; save</code>、<code class="notranslate">delete标签 -&gt; remove</code></strong></p>
</blockquote>
<blockquote>
<p><strong>这种方式存在代码重复较多，累赘！</strong></p>
</blockquote>
<h4><strong>2.只定义dao接口类，SqlSession的getMapper方法生成dao的代理对象（使用XML）</strong></h4>
<p><strong>创建dao接口：并没有用xxxDaoImpl实现这个接口</strong></p>
<div class="highlight highlight-source-java"><pre class="notranslate">	<span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-smi">SkillDao</span> {
    	   <span class="pl-smi">boolean</span> <span class="pl-en">save</span>(<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span>);
    	   <span class="pl-smi">boolean</span> <span class="pl-en">update</span>(<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span>);
    	   <span class="pl-smi">boolean</span> <span class="pl-en">remove</span>(<span class="pl-smi">Integer</span> <span class="pl-s1">id</span>);
    	   <span class="pl-smi">Skill</span> <span class="pl-en">get</span>(<span class="pl-smi">Integer</span> <span class="pl-s1">id</span>);
    	   <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-en">list</span>();
	}</pre></div>
<p><strong>则在映射文件中的sql语句实现</strong></p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span> ?&gt;
&lt;!<span class="pl-ent">DOCTYPE</span> <span class="pl-e">mapper</span>
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;<span class="pl-ent">mapper</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ws.dao.SkillDao<span class="pl-pds">"</span></span>&gt;    #这里必须使用全名
    &lt;<span class="pl-ent">sql</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlList<span class="pl-pds">"</span></span>&gt;SELECT * FROM skill&lt;/<span class="pl-ent">sql</span>&gt;

<span class="pl-c"><span class="pl-c">&lt;!--</span>    指定调用有参构造方法(level,name)<span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">resultMap</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>rmGet<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>Skill<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">constructor</span>&gt;
            &lt;<span class="pl-ent">arg</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>level<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>level<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">arg</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span> <span class="pl-e">column</span>=<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">constructor</span>&gt;
    &lt;/<span class="pl-ent">resultMap</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>get<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>rmGet<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlList<span class="pl-pds">"</span></span>/&gt; WHERE id = #{id}
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>list<span class="pl-pds">"</span></span> <span class="pl-e">resultType</span>=<span class="pl-s"><span class="pl-pds">"</span>Skill<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">include</span> <span class="pl-e">refid</span>=<span class="pl-s"><span class="pl-pds">"</span>sqlList<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">select</span>&gt;

    &lt;<span class="pl-ent">update</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>update<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>Skill<span class="pl-pds">"</span></span>&gt;
        UPDATE skill SET name = #{name}, level = #{level} WHERE id = #{id}
    &lt;/<span class="pl-ent">update</span>&gt;

    &lt;<span class="pl-ent">insert</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>save<span class="pl-pds">"</span></span>
            <span class="pl-e">useGeneratedKeys</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> <span class="pl-e">keyProperty</span>=<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
            <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>Skill<span class="pl-pds">"</span></span>&gt;
        INSERT INTO skill(name, level) VALUES(#{name}, #{level})
<span class="pl-c"><span class="pl-c">&lt;!--</span>        &lt;selectKey keyProperty="id" resultType="int" order="AFTER"&gt;<span class="pl-c">--&gt;</span></span>
<span class="pl-c"><span class="pl-c">&lt;!--</span>            SELECT LAST_INSERT_ID()<span class="pl-c">--&gt;</span></span>
<span class="pl-c"><span class="pl-c">&lt;!--</span>        &lt;/selectKey&gt;<span class="pl-c">--&gt;</span></span>
    &lt;/<span class="pl-ent">insert</span>&gt;

    &lt;<span class="pl-ent">delete</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>remove<span class="pl-pds">"</span></span> <span class="pl-e">parameterType</span>=<span class="pl-s"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span>&gt;
        DELETE FROM skill WHERE id = #{id}
    &lt;/<span class="pl-ent">delete</span>&gt;
&lt;/<span class="pl-ent">mapper</span>&gt;</pre></div>
<h4><strong>测试代码</strong></h4>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-smi">SkillTest</span> {

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">get</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-c">// 生成SkillDao的代理对象(外面并没有具体实现SkillDaoImpl)</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">dao</span>.<span class="pl-en">get</span>(<span class="pl-c1">2</span>));
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">list</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">dao</span>.<span class="pl-en">list</span>());
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">save</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">save</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"mj888"</span>, <span class="pl-c1">100</span>)));
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">update</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> = <span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"666"</span>, <span class="pl-c1">99</span>);
            <span class="pl-s1">skill</span>.<span class="pl-en">setId</span>(<span class="pl-c1">22</span>);
            <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">update</span>(<span class="pl-s1">skill</span>));
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">remove</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">remove</span>(<span class="pl-c1">22</span>));
        }
    }
}</pre></div>
<blockquote>
<p><strong>这里在获取到session后，直接用session的getMapper()方法加载xxxDao接口的代理对象；</strong></p>
</blockquote>
<blockquote>
<p><strong>当执行到dao.get()或者list()、save()等方法时，会去namespace为com.ws.dao.SkillDao中选择对应的方法执行；</strong></p>
</blockquote>
<blockquote>
<p><strong>mapper的namespace必须是dao接口类的全类名；</strong></p>
</blockquote>
<blockquote>
<p><strong>mapper中的select、update、insert、delete的id值必须和dao的方法名是一致的；</strong></p>
</blockquote>
<blockquote>
<p><strong>如果update、insert、delete方法的返回值是Boolean类型，则代理对象内部是影响记录数大于0就返回true；</strong></p>
</blockquote>
<h4><strong>3.只定义dao接口类，SqlSession的getMapper方法生成dao的代理对象（使用注解）</strong></h4>
<blockquote>
<p><strong>同样不在dao中具体实现impl，也不编写映射文件xml，只是用注解的方式在dao接口类对应方法上注解编写sql语句，所以在mybatis配置文件中也不用实现实体映射</strong></p>
</blockquote>
<p><strong>创建dao接口：并没有用xxxDaoImpl实现这个接口，也没有映射文件xml</strong></p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-c1">@</span><span class="pl-c1">CacheNamespace</span>(<span class="pl-s1">flushInterval</span> = <span class="pl-c1">600000</span>, <span class="pl-s1">size</span> = <span class="pl-c1">512</span>, <span class="pl-s1">readWrite</span> = <span class="pl-c1">true</span>)
<span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-smi">SkillDao</span> {
<span class="pl-c">//    @SelectKey(statement = "SELECT LAST_INSERT_ID()",</span>
<span class="pl-c">//            keyProperty = "id", before = false, resultType = Integer.class)</span>

<span class="pl-c">//    @Options(useGeneratedKeys = true, keyProperty = "id")</span>

    <span class="pl-c1">@</span><span class="pl-c1">Insert</span>(<span class="pl-s">"INSERT INTO skill(name, level) VALUES (#{name}, #{level})"</span>)
    <span class="pl-smi">boolean</span> <span class="pl-en">save</span>(<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span>);

    <span class="pl-c1">@</span><span class="pl-c1">Update</span>(<span class="pl-s">"UPDATE skill SET name = #{name}, level = #{level} WHERE id = #{id}"</span>)
    <span class="pl-smi">boolean</span> <span class="pl-en">update</span>(<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span>);

    <span class="pl-c1">@</span><span class="pl-c1">Delete</span>(<span class="pl-s">"DELETE FROM skill WHERE id = #{id}"</span>)
    <span class="pl-smi">boolean</span> <span class="pl-en">remove</span>(<span class="pl-smi">Integer</span> <span class="pl-s1">id</span>);

    <span class="pl-c1">@</span><span class="pl-c1">Select</span>(<span class="pl-s">"SELECT * FROM skill WHERE id = #{id}"</span>)
    <span class="pl-smi">Skill</span> <span class="pl-en">get</span>(<span class="pl-smi">Integer</span> <span class="pl-s1">id</span>);

    <span class="pl-c1">@</span><span class="pl-c1">Select</span>(<span class="pl-s">"SELECT * FROM skill"</span>)
    <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-en">list</span>();

    <span class="pl-c1">@</span><span class="pl-c1">Select</span>(<span class="pl-s">"SELECT * FROM skill LIMIT #{start}, #{size}"</span>)
    <span class="pl-c">//@Param:用来设置参数名，用来将穿进去的int start/size与sql语句的#{start}/#{size}对应</span>
    <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-en">listByStartAndSize</span>(<span class="pl-c1">@</span><span class="pl-c1">Param</span>(<span class="pl-s">"start"</span>) <span class="pl-smi">int</span> <span class="pl-s1">start</span>,
                                   <span class="pl-c1">@</span><span class="pl-c1">Param</span>(<span class="pl-s">"size"</span>) <span class="pl-smi">int</span> <span class="pl-s1">size</span>);
}</pre></div>
<h4><strong>测试代码</strong></h4>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-smi">SkillTest</span> {
    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">get</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">dao</span>.<span class="pl-en">get</span>(<span class="pl-c1">2</span>));
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">list</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">dao</span>.<span class="pl-en">list</span>());
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">list2</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>()) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">List</span>&lt;<span class="pl-smi">Skill</span>&gt; <span class="pl-s1">skills</span> = <span class="pl-s1">dao</span>.<span class="pl-en">listByStartAndSize</span>(<span class="pl-c1">0</span>, <span class="pl-c1">10</span>);
            <span class="pl-k">for</span> (<span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> : <span class="pl-s1">skills</span>) {
                <span class="pl-smi">System</span>.<span class="pl-s1">out</span>.<span class="pl-en">println</span>(<span class="pl-s1">skill</span>);
            }
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">save</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">save</span>(<span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"mj888"</span>, <span class="pl-c1">100</span>)));
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">update</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">Skill</span> <span class="pl-s1">skill</span> = <span class="pl-k">new</span> <span class="pl-smi">Skill</span>(<span class="pl-s">"666"</span>, <span class="pl-c1">99</span>);
            <span class="pl-s1">skill</span>.<span class="pl-en">setId</span>(<span class="pl-c1">17</span>);
            <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">update</span>(<span class="pl-s1">skill</span>));
        }
    }

    <span class="pl-c1">@</span><span class="pl-c1">Test</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">remove</span>() {
        <span class="pl-k">try</span> (<span class="pl-smi">SqlSession</span> <span class="pl-s1">session</span> = <span class="pl-smi">MyBatises</span>.<span class="pl-en">openSession</span>(<span class="pl-c1">true</span>)) {
            <span class="pl-c">// 生成SkillDao的代理对象</span>
            <span class="pl-smi">SkillDao</span> <span class="pl-s1">dao</span> = <span class="pl-s1">session</span>.<span class="pl-en">getMapper</span>(<span class="pl-smi">SkillDao</span>.<span class="pl-k">class</span>);
            <span class="pl-smi">Assert</span>.<span class="pl-en">assertTrue</span>(<span class="pl-s1">dao</span>.<span class="pl-en">remove</span>(<span class="pl-c1">17</span>));
        }
    }
}</pre></div>
<p><strong>注意：</strong></p>
<ul>
<li>在上面的xxxDao接口代码中，使用到了注解的方式，除了常用的 <code class="notranslate">@select</code>、<code class="notranslate">@insert</code>、<code class="notranslate">@update</code>等，还有多表关联后的注解写法和标签对应，即纯注解与xml文件的标签对应关系：</li>
<li><code class="notranslate">@param</code> 设置参数名，以将传入参数与sql语句参数占位标志对应</li>
<li><code class="notranslate">@results、@resultMap</code> 对应映射文件中字段映射 <code class="notranslate">&lt;resultMap&gt;</code></li>
<li><code class="notranslate">@result</code> 对应 <code class="notranslate">&lt;id&gt;</code>、<code class="notranslate">&lt;result&gt;</code></li>
<li><code class="notranslate">@one</code> 对应 <code class="notranslate">&lt;association&gt;</code> 单表</li>
<li><code class="notranslate">@many</code> 对应 <code class="notranslate">&lt;collection&gt;</code> 多表关联</li>
<li><code class="notranslate">@selectedKey</code> 返回操作的那个数据的id 对应之前的 <code class="notranslate">keyProperty</code> 与 <code class="notranslate">useGeneratedKeys</code> 两种写法 *</li>
<li><code class="notranslate">@CacheNamespace</code> 开启二级缓存，没有了xml文件用这个代替，其中属性 <code class="notranslate">readWrite</code> 对应之前的 <code class="notranslate">readOnly（序列化与反序列化）</code></li>
</ul>
<p><strong>使用MyBatis实现Dao层的几种方式总结：</strong></p>
<ol>
<li>第一种代码冗余，较差；</li>
<li>目前来看注解比较简单，也没有映射文件，直接将sql语句注解在dao接口类中，不用具体实现；</li>
<li>但缺点也有：①简单增删改查还行，当涉及多表关联查询时，sql语句十分复杂，注解没有xml文件逻辑清晰；②当把sql写在dao的接口类中后，java代码会编译成.class文件，不能在项目部署后直接修改，十分麻烦，即不能动态编辑sql语句，而xml文件.xml可以直接打开编辑；</li>
<li>所以使用注解与xml文件的混用，如果sql语句较为复杂或者想动态修改的sql语句，我们可以写在xml文件中；</li>
</ol>
<h2><strong>MyBatis的常见问题解答</strong></h2>
<h4><strong>1、#{}和${}的区别是什么？</strong></h4>
<p>答：</p>
<ul>
<li><code class="notranslate">${}</code>是 Properties 文件中的变量占位符，它可以用于标签属性值和 sql 内部，属于静态文本替换，比如${driver}会被静态替换为<code class="notranslate">com.mysql.jdbc.Driver</code>。</li>
<li><code class="notranslate">#{}</code>是 sql 的参数占位符，MyBatis 会将 sql 中的<code class="notranslate">#{}</code>替换为?号，在 sql 执行前会使用 PreparedStatement 的参数设置方法，按序给 sql 的?号占位符设置参数值，比如 ps.setInt(0, parameterValue)，<code class="notranslate">#{item.name}</code> 的取值方式为使用反射从参数对象中获取 item 对象的 name 属性值，相当于 <code class="notranslate">param.getItem().getName()</code>。</li>
</ul>
<h4><strong>2、Xml 映射文件中，除了常见的 select|insert|update|delete 标签之外，还有哪些标签？</strong></h4>
<p>答：还有很多其他的标签，<code class="notranslate">&lt;resultMap&gt;</code>、<code class="notranslate">&lt;parameterMap&gt;</code>、<code class="notranslate">&lt;sql&gt;</code>、<code class="notranslate">&lt;include&gt;</code>、<code class="notranslate">&lt;selectKey&gt;</code>，加上动态 sql 的 9 个标签，<code class="notranslate">trim|where|set|foreach|if|choose|when|otherwise|bind</code>等，其中为 sql 片段标签，通过<code class="notranslate">&lt;include&gt;</code>标签引入 sql 片段，<code class="notranslate">&lt;selectKey&gt;</code>为不支持自增的主键生成策略标签。</p>
<h4><strong>3、最佳实践中，通常一个 Xml 映射文件，都会写一个 Dao 接口与之对应，请问，这个 Dao 接口的工作原理是什么？Dao 接口里的方法，参数不同时，方法能重载吗？</strong></h4>
<p>答：Dao 接口，就是人们常说的 <code class="notranslate">Mapper</code>接口，接口的全限名，就是映射文件中的 namespace 的值，接口的方法名，就是映射文件中<code class="notranslate">MappedStatement</code>的 id 值，接口方法内的参数，就是传递给 sql 的参数。<code class="notranslate">Mapper</code>接口是没有实现类的，当调用接口方法时，接口全限名+方法名拼接字符串作为 key 值，可唯一定位一个<code class="notranslate">MappedStatement</code>，举例：<code class="notranslate">com.mybatis3.mappers.StudentDao.findStudentById</code>，可以唯一找到 namespace 为<code class="notranslate">com.mybatis3.mappers.StudentDao</code>下面<code class="notranslate">id = findStudentById</code>的<code class="notranslate">MappedStatement</code>。在 MyBatis 中，每一个<code class="notranslate">&lt;select&gt;</code>、<code class="notranslate">&lt;insert&gt;</code>、<code class="notranslate">&lt;update&gt;</code>、<code class="notranslate">&lt;delete&gt;</code>标签，都会被解析为一个<code class="notranslate">MappedStatement</code>对象。</p>
<p>Dao 接口里的方法可以重载，但是Mybatis的XML里面的ID不允许重复。</p>
<p>Mybatis版本3.3.0，亲测如下：</p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-c">/**</span>
<span class="pl-c"> * Mapper接口里面方法重载</span>
<span class="pl-c"> */</span>
<span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-smi">StuMapper</span> {

	<span class="pl-smi">List</span>&lt;<span class="pl-smi">Student</span>&gt; <span class="pl-en">getAllStu</span>();
    
	<span class="pl-smi">List</span>&lt;<span class="pl-smi">Student</span>&gt; <span class="pl-en">getAllStu</span>(<span class="pl-c1">@</span><span class="pl-c1">Param</span>(<span class="pl-s">"id"</span>) <span class="pl-smi">Integer</span> <span class="pl-s1">id</span>);
}</pre></div>
<p>然后在 <code class="notranslate">StuMapper.xml</code> 中利用Mybatis的动态sql就可以实现。</p>
<div class="highlight highlight-source-java"><pre class="notranslate">	&lt;<span class="pl-s1">select</span> <span class="pl-s1">id</span>=<span class="pl-s">"getAllStu"</span> <span class="pl-s1">resultType</span>=<span class="pl-s">"com.pojo.Student"</span>&gt;
 		<span class="pl-s1">select</span> * <span class="pl-smi">from</span> <span class="pl-smi">student</span>
		&lt;<span class="pl-smi">where</span>&gt;
			&lt;<span class="pl-k">if</span> <span class="pl-s1">test</span>=<span class="pl-s">"id != null"</span>&gt;
				<span class="pl-s1">id</span> = #{<span class="pl-s1">id</span>}
			&lt;/<span class="pl-s1">if</span>&gt;
		&lt;/<span class="pl-s1">where</span>&gt;
 	&lt;/<span class="pl-s1">select</span>&gt;</pre></div>
<p>能正常运行，并能得到相应的结果，这样就实现了在Dao接口中写重载方法。</p>
<p><strong>Mybatis 的 Dao 接口可以有多个重载方法，但是多个接口对应的映射必须只有一个，否则启动会报错。</strong></p>
<p>相关 issue ：<a href="https://github.com/Snailclimb/JavaGuide/issues/1122" data-hovercard-type="issue" data-hovercard-url="/Snailclimb/JavaGuide/issues/1122/hovercard">更正：Dao 接口里的方法可以重载，但是Mybatis的XML里面的ID不允许重复！</a>。</p>
<p>Dao 接口的工作原理是 JDK 动态代理，MyBatis 运行时会使用 JDK 动态代理为 Dao 接口生成代理 proxy 对象，代理对象 proxy 会拦截接口方法，转而执行<code class="notranslate">MappedStatement</code>所代表的 sql，然后将 sql 执行结果返回。</p>
<h5>==补充：==</h5>
<p>Dao接口方法可以重载，但是需要满足以下条件：</p>
<ol>
<li>仅有一个无参方法和一个有参方法</li>
<li>多个有参方法时，参数数量必须一致。且使用相同的 <code class="notranslate">@Param</code> ，或者使用 <code class="notranslate">param1</code> 这种</li>
</ol>
<p>测试如下：</p>
<p><code class="notranslate">PersonDao.java</code></p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-smi">Person</span> <span class="pl-en">queryById</span>();

<span class="pl-smi">Person</span> <span class="pl-en">queryById</span>(<span class="pl-c1">@</span><span class="pl-c1">Param</span>(<span class="pl-s">"id"</span>) <span class="pl-smi">Long</span> <span class="pl-s1">id</span>);

<span class="pl-smi">Person</span> <span class="pl-en">queryById</span>(<span class="pl-c1">@</span><span class="pl-c1">Param</span>(<span class="pl-s">"id"</span>) <span class="pl-smi">Long</span> <span class="pl-s1">id</span>, <span class="pl-c1">@</span><span class="pl-c1">Param</span>(<span class="pl-s">"name"</span>) <span class="pl-smi">String</span> <span class="pl-s1">name</span>);</pre></div>
<p><code class="notranslate">PersonMapper.xml</code></p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;<span class="pl-ent">select</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>queryById<span class="pl-pds">"</span></span> <span class="pl-e">resultMap</span>=<span class="pl-s"><span class="pl-pds">"</span>PersonMap<span class="pl-pds">"</span></span>&gt;
    select
      id, name, age, address
    from person
    &lt;<span class="pl-ent">where</span>&gt;
        &lt;<span class="pl-ent">if</span> <span class="pl-e">test</span>=<span class="pl-s"><span class="pl-pds">"</span>id != null<span class="pl-pds">"</span></span>&gt;
            id = #{id}
        &lt;/<span class="pl-ent">if</span>&gt;
        &lt;<span class="pl-ent">if</span> <span class="pl-e">test</span>=<span class="pl-s"><span class="pl-pds">"</span>name != null and name != ''<span class="pl-pds">"</span></span>&gt;
            name = #{name}
        &lt;/<span class="pl-ent">if</span>&gt;
    &lt;/<span class="pl-ent">where</span>&gt;
    limit 1
&lt;/<span class="pl-ent">select</span>&gt;</pre></div>
<p><code class="notranslate">org.apache.ibatis.scripting.xmltags.DynamicContext.ContextAccessor#getProperty</code>方法用于获取<code class="notranslate">&lt;if&gt;</code>标签中的条件值</p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-smi">Object</span> <span class="pl-en">getProperty</span>(<span class="pl-smi">Map</span> <span class="pl-s1">context</span>, <span class="pl-smi">Object</span> <span class="pl-s1">target</span>, <span class="pl-smi">Object</span> <span class="pl-s1">name</span>) {
  <span class="pl-smi">Map</span> <span class="pl-s1">map</span> = (<span class="pl-smi">Map</span>) <span class="pl-s1">target</span>;

  <span class="pl-smi">Object</span> <span class="pl-s1">result</span> = <span class="pl-s1">map</span>.<span class="pl-en">get</span>(<span class="pl-s1">name</span>);
  <span class="pl-k">if</span> (<span class="pl-s1">map</span>.<span class="pl-en">containsKey</span>(<span class="pl-s1">name</span>) || <span class="pl-s1">result</span> != <span class="pl-c1">null</span>) {
    <span class="pl-k">return</span> <span class="pl-s1">result</span>;
  }

  <span class="pl-smi">Object</span> <span class="pl-s1">parameterObject</span> = <span class="pl-s1">map</span>.<span class="pl-en">get</span>(<span class="pl-c1">PARAMETER_OBJECT_KEY</span>);
  <span class="pl-k">if</span> (<span class="pl-s1">parameterObject</span> <span class="pl-k">instanceof</span> <span class="pl-smi">Map</span>) {
    <span class="pl-k">return</span> ((<span class="pl-smi">Map</span>)<span class="pl-s1">parameterObject</span>).<span class="pl-en">get</span>(<span class="pl-s1">name</span>);
  }

  <span class="pl-k">return</span> <span class="pl-c1">null</span>;
}</pre></div>
<p><code class="notranslate">parameterObject</code>为map，存放的是Dao接口中参数相关信息。</p>
<p><code class="notranslate">((Map)parameterObject).get(name)</code>方法如下</p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-smi">V</span> <span class="pl-en">get</span>(<span class="pl-smi">Object</span> <span class="pl-s1">key</span>) {
  <span class="pl-k">if</span> (!<span class="pl-en">super</span>.<span class="pl-en">containsKey</span>(<span class="pl-s1">key</span>)) {
    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">BindingException</span>(<span class="pl-s">"Parameter '"</span> + <span class="pl-s1">key</span> + <span class="pl-s">"' not found. Available parameters are "</span> + <span class="pl-en">keySet</span>());
  }
  <span class="pl-k">return</span> <span class="pl-en">super</span>.<span class="pl-en">get</span>(<span class="pl-s1">key</span>);
}</pre></div>
<ol>
<li><code class="notranslate">queryById()</code>方法执行时，<code class="notranslate">parameterObject</code>为null，<code class="notranslate">getProperty</code>方法返回null值，<code class="notranslate">&lt;if&gt;</code>标签获取的所有条件值都为null，所有条件不成立，动态sql可以正常执行。</li>
<li><code class="notranslate">queryById(1L)</code>方法执行时，<code class="notranslate">parameterObject</code>为map，包含了<code class="notranslate">id</code>和<code class="notranslate">param1</code>两个key值。当获取<code class="notranslate">&lt;if&gt;</code>标签中<code class="notranslate">name</code>的属性值时，进入<code class="notranslate">((Map)parameterObject).get(name)</code>方法中，map中key不包含<code class="notranslate">name</code>，所以抛出异常。</li>
<li><code class="notranslate">queryById(1L,"1")</code>方法执行时，<code class="notranslate">parameterObject</code>中包含<code class="notranslate">id</code>,<code class="notranslate">param1</code>,<code class="notranslate">name</code>,<code class="notranslate">param2</code>四个key值，<code class="notranslate">id</code>和<code class="notranslate">name</code>属性都可以获取到，动态sql正常执行。</li>
</ol>
<h4><strong>4、MyBatis 是如何进行分页的？分页插件的原理是什么？</strong></h4>
<p>答：<strong>(1)</strong> MyBatis 使用 RowBounds 对象进行分页，它是针对 ResultSet 结果集执行的内存分页，而非物理分页；<strong>(2)</strong> 可以在 sql 内直接书写带有物理分页的参数来完成物理分页功能，<strong>(3)</strong> 也可以使用分页插件来完成物理分页。</p>
<p>分页插件的基本原理是使用 MyBatis 提供的插件接口，实现自定义插件，在插件的拦截方法内拦截待执行的 sql，然后重写 sql，根据 dialect 方言，添加对应的物理分页语句和物理分页参数。</p>
<p>举例：<code class="notranslate">select _ from student</code>，拦截 sql 后重写为：<code class="notranslate">select t._ from （select \* from student）t limit 0，10</code></p>
<h4><strong>5、简述 MyBatis 的插件运行原理，以及如何编写一个插件。</strong></h4>
<p>答：MyBatis 仅可以编写针对 <code class="notranslate">ParameterHandler</code>、<code class="notranslate">ResultSetHandler</code>、<code class="notranslate">StatementHandler</code>、<code class="notranslate">Executor</code> 这 4 种接口的插件，MyBatis 使用 JDK 的动态代理，为需要拦截的接口生成代理对象以实现接口方法拦截功能，每当执行这 4 种接口对象的方法时，就会进入拦截方法，具体就是 <code class="notranslate">InvocationHandler</code> 的 <code class="notranslate">invoke()</code>方法，当然，只会拦截那些你指定需要拦截的方法。</p>
<p>实现 MyBatis 的 Interceptor 接口并复写<code class="notranslate"> intercept()</code>方法，然后在给插件编写注解，指定要拦截哪一个接口的哪些方法即可，记住，别忘了在配置文件中配置你编写的插件。</p>
<h4>6、<strong>MyBatis 执行批量插入，能返回数据库主键列表吗？</strong></h4>
<p>答：能，JDBC 都能，MyBatis 当然也能。</p>
<h4><strong>7、MyBatis 动态 sql 是做什么的？都有哪些动态 sql？能简述一下动态 sql 的执行原理不？</strong></h4>
<p>答：MyBatis 动态 sql 可以让我们在 Xml 映射文件内，以标签的形式编写动态 sql，完成逻辑判断和动态拼接 sql 的功能，MyBatis 提供了 9 种动态 sql 标签 <code class="notranslate">trim|where|set|foreach|if|choose|when|otherwise|bind</code>。</p>
<p>其执行原理为，使用 OGNL 从 sql 参数对象中计算表达式的值，根据表达式的值动态拼接 sql，以此来完成动态 sql 的功能。</p>
<h4><strong>8、MyBatis 是如何将 sql 执行结果封装为目标对象并返回的？都有哪些映射形式？</strong></h4>
<p>答：第一种是使用<code class="notranslate">&lt;resultMap&gt;</code>标签，逐一定义列名和对象属性名之间的映射关系。第二种是使用 sql 列的别名功能，将列别名书写为对象属性名，比如 T_NAME AS NAME，对象属性名一般是 name，小写，但是列名不区分大小写，MyBatis 会忽略列名大小写，智能找到与之对应对象属性名，你甚至可以写成 T_NAME AS NaMe，MyBatis 一样可以正常工作。</p>
<p>有了列名与属性名的映射关系后，MyBatis 通过反射创建对象，同时使用反射给对象的属性逐一赋值并返回，那些找不到映射关系的属性，是无法完成赋值的。</p>
<h4><strong>9、MyBatis 能执行一对一、一对多的关联查询吗？都有哪些实现方式，以及它们之间的区别。</strong></h4>
<p>答：能，MyBatis 不仅可以执行一对一、一对多的关联查询，还可以执行多对一，多对多的关联查询，多对一查询，其实就是一对一查询，只需要把 <code class="notranslate">selectOne()</code>修改为 <code class="notranslate">selectList()</code>即可；多对多查询，其实就是一对多查询，只需要把 <code class="notranslate">selectOne()</code>修改为 <code class="notranslate">selectList()</code>即可。</p>
<p>关联对象查询，有两种实现方式，一种是单独发送一个 sql 去查询关联对象，赋给主对象，然后返回主对象。另一种是使用嵌套查询，嵌套查询的含义为使用 join 查询，一部分列是 A 对象的属性值，另外一部分列是关联对象 B 的属性值，好处是只发一个 sql 查询，就可以把主对象和其关联对象查出来。</p>
<p>那么问题来了，join 查询出来 100 条记录，如何确定主对象是 5 个，而不是 100 个？其去重复的原理是<code class="notranslate">&lt;resultMap&gt;</code>标签内的<code class="notranslate">&lt;id&gt;</code>子标签，指定了唯一确定一条记录的 id 列，MyBatis 根据列值来完成 100 条记录的去重复功能，<code class="notranslate">&lt;id&gt;</code>可以有多个，代表了联合主键的语意。</p>
<p>同样主对象的关联对象，也是根据这个原理去重复的，尽管一般情况下，只有主对象会有重复记录，关联对象一般不会重复。</p>
<p>举例：下面 join 查询出来 6 条记录，一、二列是 Teacher 对象列，第三列为 Student 对象列，MyBatis 去重复处理后，结果为 1 个老师 6 个学生，而不是 6 个老师 6 个学生。</p>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>t_id</th>
<th>t_name</th>
<th>s_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>teacher</td>
<td>38</td>
</tr>
<tr>
<td>1</td>
<td>teacher</td>
<td>39</td>
</tr>
<tr>
<td>1</td>
<td>teacher</td>
<td>40</td>
</tr>
<tr>
<td>1</td>
<td>teacher</td>
<td>41</td>
</tr>
<tr>
<td>1</td>
<td>teacher</td>
<td>42</td>
</tr>
<tr>
<td>1</td>
<td>teacher</td>
<td>43</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<h4><strong>10、MyBatis 是否支持延迟加载？如果支持，它的实现原理是什么？</strong></h4>
<p>答：MyBatis 仅支持 association 关联对象和 collection 关联集合对象的延迟加载，association 指的就是一对一，collection 指的就是一对多查询。在 MyBatis 配置文件中，可以配置是否启用延迟加载 <code class="notranslate">lazyLoadingEnabled=true|false。</code></p>
<p>它的原理是，使用<code class="notranslate"> CGLIB</code> 创建目标对象的代理对象，当调用目标方法时，进入拦截器方法，比如调用 <code class="notranslate">a.getB().getName()</code>，拦截器 <code class="notranslate">invoke()</code>方法发现 <code class="notranslate">a.getB()</code>是 null 值，那么就会单独发送事先保存好的查询关联 B 对象的 sql，把 B 查询上来，然后调用 a.setB(b)，于是 a 的对象 b 属性就有值了，接着完成 <code class="notranslate">a.getB().getName()</code>方法的调用。这就是延迟加载的基本原理。</p>
<p>当然了，不光是 MyBatis，几乎所有的包括 Hibernate，支持延迟加载的原理都是一样的。</p>
<h4><strong>11、MyBatis 的 Xml 映射文件中，不同的 Xml 映射文件，id 是否可以重复？</strong></h4>
<p>答：不同的 Xml 映射文件，如果配置了 namespace，那么 id 可以重复；如果没有配置 namespace，那么 id 不能重复；毕竟 namespace 不是必须的，只是最佳实践而已。</p>
<p>原因就是 namespace+id 是作为 <code class="notranslate">Map&lt;String, MappedStatement&gt;</code>的 key 使用的，如果没有 namespace，就剩下 id，那么，id 重复会导致数据互相覆盖。有了 namespace，自然 id 就可以重复，namespace 不同，namespace+id 自然也就不同。</p>
<h4><strong>12、MyBatis 中如何执行批处理？</strong></h4>
<p>答：使用 BatchExecutor 完成批处理。</p>
<h4><strong>13、MyBatis 都有哪些 Executor 执行器？它们之间的区别是什么？</strong></h4>
<p>答：MyBatis 有三种基本的 Executor 执行器，<strong><code class="notranslate">SimpleExecutor</code>、<code class="notranslate">ReuseExecutor</code>、<code class="notranslate">BatchExecutor</code>。</strong></p>
<p>**<code class="notranslate">SimpleExecutor</code>：**每执行一次 update 或 select，就开启一个 Statement 对象，用完立刻关闭 Statement 对象。</p>
<p>**<code class="notranslate">ReuseExecutor</code>：**执行 update 或 select，以 sql 作为 key 查找 Statement 对象，存在就使用，不存在就创建，用完后，不关闭 Statement 对象，而是放置于 Map&lt;String, Statement&gt;内，供下一次使用。简言之，就是重复使用 Statement 对象。</p>
<p>**<code class="notranslate">BatchExecutor</code>：**执行 update（没有 select，JDBC 批处理不支持 select），将所有 sql 都添加到批处理中（addBatch()），等待统一执行（executeBatch()），它缓存了多个 Statement 对象，每个 Statement 对象都是 addBatch()完毕后，等待逐一执行 executeBatch()批处理。与 JDBC 批处理相同。</p>
<p>作用范围：Executor 的这些特点，都严格限制在 SqlSession 生命周期范围内。</p>
<h4><strong>14、MyBatis 中如何指定使用哪一种 Executor 执行器？</strong></h4>
<p>答：在 MyBatis 配置文件中，可以指定默认的 ExecutorType 执行器类型，也可以手动给 <code class="notranslate">DefaultSqlSessionFactory</code> 的创建 SqlSession 的方法传递 ExecutorType 类型参数。</p>
<h4><strong>15、MyBatis 是否可以映射 Enum 枚举类？</strong></h4>
<p>答：MyBatis 可以映射枚举类，不单可以映射枚举类，MyBatis 可以映射任何对象到表的一列上。映射方式为自定义一个 <code class="notranslate">TypeHandler</code>，实现 <code class="notranslate">TypeHandler</code> 的 <code class="notranslate">setParameter()</code>和 <code class="notranslate">getResult()</code>接口方法。<code class="notranslate">TypeHandler</code> 有两个作用，一是完成从 javaType 至 jdbcType 的转换，二是完成 jdbcType 至 javaType 的转换，体现为 <code class="notranslate">setParameter()</code>和 <code class="notranslate">getResult()</code>两个方法，分别代表设置 sql 问号占位符参数和获取列查询结果。</p>
<h4><strong>16、MyBatis 映射文件中，如果 A 标签通过 include 引用了 B 标签的内容，请问，B 标签能否定义在 A 标签的后面，还是说必须定义在 A 标签的前面？</strong></h4>
<p>答：虽然 MyBatis 解析 Xml 映射文件是按照顺序解析的，但是，被引用的 B 标签依然可以定义在任何地方，MyBatis 都可以正确识别。</p>
<p>原理是，MyBatis 解析 A 标签，发现 A 标签引用了 B 标签，但是 B 标签尚未解析到，尚不存在，此时，MyBatis 会将 A 标签标记为未解析状态，然后继续解析余下的标签，包含 B 标签，待所有标签解析完毕，MyBatis 会重新解析那些被标记为未解析的标签，此时再解析 A 标签时，B 标签已经存在，A 标签也就可以正常解析完成了。</p>
<h4><strong>17、简述 MyBatis 的 Xml 映射文件和 MyBatis 内部数据结构之间的映射关系？</strong></h4>
<p>答：MyBatis 将所有 Xml 配置信息都封装到 All-In-One 重量级对象 Configuration 内部。在 Xml 映射文件中，<code class="notranslate">&lt;parameterMap&gt;</code>标签会被解析为 <code class="notranslate">ParameterMap</code> 对象，其每个子元素会被解析为 ParameterMapping 对象。<code class="notranslate">&lt;resultMap&gt;</code>标签会被解析为 <code class="notranslate">ResultMap</code> 对象，其每个子元素会被解析为 <code class="notranslate">ResultMapping</code> 对象。每一个<code class="notranslate">&lt;select&gt;、&lt;insert&gt;、&lt;update&gt;、&lt;delete&gt;</code>标签均会被解析为 <code class="notranslate">MappedStatement</code> 对象，标签内的 sql 会被解析为 BoundSql 对象。</p>
<h4><strong>18、为什么说 MyBatis 是半自动 ORM 映射工具？它与全自动的区别在哪里？</strong></h4>
<p>答：Hibernate 属于全自动 ORM 映射工具，使用 Hibernate 查询关联对象或者关联集合对象时，可以根据对象关系模型直接获取，所以它是全自动的。而 MyBatis 在查询关联对象或关联集合对象时，需要手动编写 sql 来完成，所以，称之为半自动 ORM 映射工具。</p>
<p>面试题看似都很简单，但是想要能正确回答上来，必定是研究过源码且深入的人，而不是仅会使用的人或者用的很熟的人，以上所有面试题及其答案所涉及的内容，在我的 MyBatis 系列博客中都有详细讲解和原理分析。</p></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://shuaiwang888.github.io/appStore-Blog.github.io">Blog Title</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","shuaiwang888/appStore-Blog.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>


</html>
